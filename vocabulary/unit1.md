<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Word Bank — Unit 1: My Family | LinguaLab</title>
  <meta name="description" content="LinguaLab Word Bank Unit 1: My Family. Flashcards with listening, quiz, and matching." />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet" />

  <style>
    :root{
      --primary:#2563eb;
      --accent:#f97316;
      --bg:#f8fafc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --navy:#1f4e79;

      --good:#16a34a;
      --bad:#ef4444;

      --radius:18px;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html{ scroll-behavior:smooth; }
    body{
      font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
      padding-top:86px;
    }
    a{ color:inherit; text-decoration:none; }
    a:focus-visible, button:focus-visible{
      outline:3px solid rgba(37,99,235,.45);
      outline-offset:3px;
      border-radius:14px;
    }

    /* NAV */
    .navbar{
      position: fixed;
      top:0; left:0;
      width:100%;
      z-index:1000;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      padding: 12px 40px;
      background:#fff;
      box-shadow:0 4px 20px rgba(0,0,0,0.05);
    }
    .navbar-left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:max-content;
    }
    .nav-logo{ height:54px; width:auto; display:block; }
    .nav-title{
      font-size:20px;
      font-weight:900;
      color:var(--navy);
      letter-spacing:.2px;
    }
    .navbar-right{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .navbar-right a{
      color:var(--navy);
      font-weight:800;
      padding:8px 12px;
      border-radius:12px;
      transition: background .2s ease, color .2s ease, transform .2s ease;
    }
    .navbar-right a:hover{
      background:var(--navy);
      color:#fff;
      transform:translateY(-1px);
    }

    /* Layout */
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding: 44px 8% 70px;
    }

    /* HERO */
    .hero{
      padding:28px 24px;
      border-radius:24px;
      background:linear-gradient(135deg,#2563eb,#7c3aed);
      color:#fff;
      box-shadow:0 14px 34px rgba(0,0,0,.12);
    }
    .hero-top{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:14px;
      flex-wrap:wrap;
    }
    .hero h1{
      margin:0 0 8px;
      font-size:clamp(24px,3vw,38px);
      line-height:1.12;
      letter-spacing:-.02em;
    }
    .hero p{
      margin:0;
      max-width:840px;
      color:rgba(255,255,255,.92);
      font-size:16px;
    }
    .hero-badges{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:12px;
      background:rgba(255,255,255,.18);
      white-space:nowrap;
      user-select:none;
    }

    /* Controls row */
    .bar{
      margin-top:14px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
    }
    .seg{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .chip{
      border:0;
      cursor:pointer;
      font-weight:900;
      border-radius:999px;
      padding:12px 14px;
      background:#fff;
      color:var(--text);
      box-shadow:0 10px 22px rgba(0,0,0,.10);
      transition:transform .18s ease, filter .18s ease, background .18s ease;
      user-select:none;
    }
    .chip:hover{ transform:translateY(-2px); filter:brightness(.98); }
    .chip.active{ background:var(--accent); color:#fff; }

    .stat{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
      font-weight:1000;
    }
    .stat span{
      background:rgba(255,255,255,.18);
      border-radius:999px;
      padding:10px 12px;
      font-size:12px;
      color:#fff;
      white-space:nowrap;
    }

    /* Panel */
    .panel{
      margin-top:18px;
      background:#fff;
      border-radius:22px;
      padding:18px 16px;
      box-shadow:0 6px 24px rgba(0,0,0,.06);
      border:1px solid rgba(15,23,42,.06);
    }
    .panel-top{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      flex-wrap:wrap;
    }
    .panel-title{
      font-weight:1000;
      font-size:18px;
      margin:0;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .panel-sub{
      margin-top:6px;
      color:var(--muted);
      font-size:14px;
      font-weight:700;
    }
    .panel-right{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }

    /* Buttons */
    .btn{
      border:0;
      cursor:pointer;
      border-radius:16px;
      padding:12px 14px;
      font-weight:1000;
      transition:transform .16s ease, filter .16s ease, background .16s ease;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .btn:hover{ transform:translateY(-2px); filter:brightness(.98); }
    .btn-primary{ background:var(--primary); color:#fff; }
    .btn-accent{ background:var(--accent); color:#fff; }
    .btn-dark{ background:#0f172a; color:#fff; }
    .btn-light{ background:#f1f5f9; color:var(--text); }
    .btn-ghost{
      background:#fff;
      color:var(--text);
      border:1px solid rgba(15,23,42,.12);
    }

    /* Flashcard */
    .card-wrap{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      justify-items:center;
    }
    .flip{
      width:min(420px, 100%);
      height:320px;
      perspective:1000px;
    }
    .inner{
      position:relative;
      width:100%;
      height:100%;
      transform-style:preserve-3d;
      transition:transform .6s cubic-bezier(.4,0,.2,1);
    }
    .inner.flipped{ transform:rotateY(180deg); }

    .face{
      position:absolute;
      inset:0;
      border-radius:22px;
      backface-visibility:hidden;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:18px;
      text-align:center;
      box-shadow:0 12px 28px rgba(0,0,0,.10);
      border:1px solid rgba(15,23,42,.06);
      cursor:pointer;
      user-select:none;
    }
    .front{ background:linear-gradient(145deg, #ffffff, #f1f5ff); }
    .back{
      transform:rotateY(180deg);
      background:linear-gradient(145deg, #ffffff, #f0fff8);
    }

    .svg{
      width:96px;
      height:96px;
      margin-bottom:10px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .word{
      font-size:34px;
      font-weight:1000;
      letter-spacing:-.02em;
    }
    .tap{
      margin-top:10px;
      font-size:12px;
      font-weight:900;
      color:var(--muted);
    }
    .zh{
      font-size:44px;
      font-weight:1000;
      color:#0f766e;
      line-height:1.1;
    }
    .py{
      margin-top:6px;
      color:var(--muted);
      font-weight:800;
    }
    .phrase{
      margin-top:10px;
      color:#1f2937;
      font-weight:900;
      font-size:14px;
      opacity:.8;
    }

    /* Progress */
    .progress{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
      margin-top:6px;
      color:var(--muted);
      font-weight:900;
    }
    .dots{
      display:flex;
      gap:8px;
      justify-content:center;
      margin-top:10px;
    }
    .dot{
      width:10px;
      height:10px;
      border-radius:999px;
      background:#e2e8f0;
      cursor:pointer;
      transition:transform .15s ease, background .15s ease;
    }
    .dot.active{
      background:var(--primary);
      transform:scale(1.25);
    }

    /* Quiz */
    .quiz, .match{ margin-top:14px; display:none; }
    .box{
      padding:16px;
      border-radius:22px;
      background:#fff;
      border:1px solid rgba(15,23,42,.06);
      box-shadow:0 10px 26px rgba(0,0,0,.08);
      text-align:center;
    }
    .quiz-prompt{
      font-size:28px;
      font-weight:1000;
      margin:8px 0 14px;
    }
    .grid2{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:10px;
      margin-top:12px;
    }
    .option{
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(15,23,42,.10);
      background:#fff;
      cursor:pointer;
      font-weight:1000;
      transition:transform .15s ease, filter .15s ease, background .15s ease, border-color .15s ease;
    }
    .option:hover{ transform:translateY(-2px); filter:brightness(.99); }
    .option.good{ background:rgba(22,163,74,.08); border-color:rgba(22,163,74,.35); }
    .option.bad{ background:rgba(239,68,68,.08); border-color:rgba(239,68,68,.35); }

    /* Match */
    .match-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:12px;
      text-align:left;
    }
    .col{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .m-btn{
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(15,23,42,.10);
      background:#fff;
      cursor:pointer;
      font-weight:1000;
      transition:transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .m-btn:hover{ transform:translateY(-2px); }
    .m-btn.selected{ border-color:rgba(37,99,235,.55); background:rgba(37,99,235,.06); }
    .m-btn.matched{ border-color:rgba(22,163,74,.45); background:rgba(22,163,74,.06); cursor:default; }

    .feedback{
      min-height:24px;
      margin-top:10px;
      font-weight:1000;
    }
    .feedback.good{ color:var(--good); }
    .feedback.bad{ color:var(--bad); }

    /* Footer */
    footer{
      background:#0f172a;
      color:#e2e8f0;
      padding:40px 8%;
      text-align:center;
      font-size:14px;
      margin-top: 30px;
    }
    footer a{ color:#93c5fd; font-weight:700; }
    footer p{ margin:10px auto; max-width:980px; color:#cbd5e1; }

    @media (max-width: 992px){
      .navbar{ padding:12px 18px; }
      .wrap{ padding:36px 6% 60px; }
    }
    @media (max-width: 600px){
      body{ padding-top:104px; }
      .navbar{ padding:10px 14px; flex-wrap:wrap; }
      .navbar-right{ width:100%; justify-content:center; }
      .match-grid{ grid-template-columns:1fr; }
    }
  </style>
</head>

<body>
  <header class="navbar">
    <div class="navbar-left">
      <img src="../assets/img/logo.png" alt="LinguaLab Logo" class="nav-logo" />
      <span class="nav-title">LinguaLab</span>
    </div>

    <nav class="navbar-right" aria-label="Primary navigation">
      <a href="../grammar.html">Grammar Magic</a>
      <a href="../vocabulary.html">Word Bank</a>
      <a href="../exercises.html">Fun Homework</a>
      <a href="../parents.html">Wiki Parents</a>
    </nav>
  </header>

  <main class="wrap">
    <section class="hero">
      <div class="hero-top">
        <div>
          <h1>Word Bank — Unit 1: My Family</h1>
          <p>Flashcards with listening, quiz, and matching. Tap and learn.</p>
        </div>

        <div class="hero-badges">
          <span class="badge">Listening: ON</span>
          <span class="badge" id="badgeProgress">1 / 6</span>
          <span class="badge" id="badgeScore">Score: 0</span>
        </div>
      </div>

      <div class="bar">
        <div class="seg" aria-label="Modes">
          <button class="chip active" id="modeLearn" type="button">Learn</button>
          <button class="chip" id="modeQuiz" type="button">Quiz</button>
          <button class="chip" id="modeMatch" type="button">Match</button>
        </div>

        <div class="stat">
          <span id="statStars">Stars: ☆☆☆☆☆</span>
          <span id="statStreak">Streak: 0</span>
        </div>
      </div>
    </section>

    <section class="panel" aria-live="polite">
      <div class="panel-top">
        <div>
          <h2 class="panel-title" id="panelTitle">Learn</h2>
          <div class="panel-sub" id="panelSub">Tap the card to flip. Use Listen to hear.</div>
        </div>

        <div class="panel-right">
          <button class="btn btn-ghost" id="btnPrev" type="button" aria-label="Previous">←</button>
          <button class="btn btn-primary" id="btnSpeak" type="button" aria-label="Listen">Listen</button>
          <button class="btn btn-ghost" id="btnNext" type="button" aria-label="Next">→</button>
        </div>
      </div>

      <!-- LEARN -->
      <section id="learnSection">
        <div class="card-wrap">
          <div class="flip" id="flipCard" aria-label="Flashcard">
            <div class="inner" id="inner">
              <div class="face front" id="frontFace" role="button" tabindex="0">
                <div class="svg" id="cardSvg"></div>
                <div class="word" id="enWord"></div>
                <div class="tap">Tap to flip</div>
              </div>

              <div class="face back" id="backFace" role="button" tabindex="0">
                <div class="zh" id="zhWord"></div>
                <div class="py" id="pyWord"></div>
                <div class="word" style="font-size:22px; margin-top:8px;" id="enBack"></div>
                <div class="phrase" id="phrase"></div>
                <div class="tap">Tap to flip</div>
              </div>
            </div>
          </div>

          <div class="progress">
            <span id="counter">1 / 6</span>
            <span>•</span>
            <span id="hintLine">Tip: Click Listen</span>
          </div>

          <div class="dots" id="dots"></div>

          <div class="row-actions" style="display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
            <button class="btn btn-light" id="btnHint" type="button">Hint (-5)</button>
            <a class="btn btn-dark" href="../exercises.html">Back to Homework</a>
          </div>

          <div class="feedback" id="learnFeedback"></div>
        </div>
      </section>

      <!-- QUIZ -->
      <section class="quiz" id="quizSection">
        <div class="box">
          <div class="svg" id="quizSvg"></div>
          <div style="color:var(--muted); font-weight:900; font-size:13px;">Choose the correct English word</div>
          <div class="quiz-prompt" id="quizPrompt"></div>

          <div class="grid2" id="quizOptions"></div>
          <div class="feedback" id="quizFeedback"></div>

          <div class="row-actions" style="display:flex; justify-content:center; margin-top:10px;">
            <button class="btn btn-accent" id="btnQuizNext" type="button">Next</button>
          </div>
        </div>
      </section>

      <!-- MATCH -->
      <section class="match" id="matchSection">
        <div class="box" style="text-align:center;">
          <div style="font-weight:1000;">Match English with Chinese</div>
          <div style="color:var(--muted); font-weight:800; font-size:13px; margin-top:4px;">
            Pick one English, then pick the matching Chinese.
          </div>

          <div class="match-grid" style="margin-top:14px;">
            <div class="col" id="colEn"></div>
            <div class="col" id="colZh"></div>
          </div>

          <div class="feedback" id="matchFeedback"></div>

          <div class="row-actions" style="display:flex; justify-content:center; gap:10px; margin-top:10px; flex-wrap:wrap;">
            <button class="btn btn-light" id="btnMatchReset" type="button">Reset</button>
            <button class="btn btn-dark" id="btnMatchNew" type="button">New Round</button>
          </div>
        </div>
      </section>
    </section>
  </main>

  <footer>
    <p>© 2026 LinguaLab. All Rights Reserved.</p>
    <p>
      <a href="../privacy.html">Privacy Policy</a> |
      <a href="../terms.html">Terms of Use</a>
    </p>
  </footer>

  <script>
    // ===== DATA =====
    const vocabulary = [
      {
        english: "Mommy",
        chinese: "妈妈",
        pinyin: "māma",
        hint: "She takes care of you and loves you!",
        phrase: "I love my mommy!",
        svg: `<svg width="96" height="96" viewBox="0 0 80 80"><circle cx="40" cy="28" r="14" fill="#ffb6c1"/><circle cx="35" cy="25" r="2" fill="#333"/><circle cx="45" cy="25" r="2" fill="#333"/><path d="M36 31 Q40 35 44 31" stroke="#e75480" stroke-width="1.5" fill="none" stroke-linecap="round"/><path d="M30 18 Q32 8 40 10 Q48 8 50 18" fill="#4a2c2a"/><rect x="30" y="42" width="20" height="28" rx="8" fill="#e75480"/><line x1="30" y1="52" x2="22" y2="62" stroke="#ffb6c1" stroke-width="4" stroke-linecap="round"/><line x1="50" y1="52" x2="58" y2="62" stroke="#ffb6c1" stroke-width="4" stroke-linecap="round"/></svg>`
      },
      {
        english: "Daddy",
        chinese: "爸爸",
        pinyin: "bàba",
        hint: "He is the father in the family.",
        phrase: "Daddy is strong!",
        svg: `<svg width="96" height="96" viewBox="0 0 80 80"><circle cx="40" cy="28" r="14" fill="#f4c28c"/><circle cx="35" cy="25" r="2" fill="#333"/><circle cx="45" cy="25" r="2" fill="#333"/><path d="M36 32 Q40 35 44 32" stroke="#b87333" stroke-width="1.5" fill="none" stroke-linecap="round"/><rect x="28" y="12" width="24" height="10" rx="4" fill="#2c5f8a"/><rect x="30" y="42" width="20" height="28" rx="8" fill="#2c5f8a"/><line x1="30" y1="52" x2="22" y2="64" stroke="#f4c28c" stroke-width="4" stroke-linecap="round"/><line x1="50" y1="52" x2="58" y2="64" stroke="#f4c28c" stroke-width="4" stroke-linecap="round"/></svg>`
      },
      {
        english: "Brother",
        chinese: "哥哥/弟弟",
        pinyin: "gēge / dìdi",
        hint: "A boy in your family.",
        phrase: "My brother plays with me.",
        svg: `<svg width="96" height="96" viewBox="0 0 80 80"><circle cx="40" cy="30" r="12" fill="#ffe0bd"/><circle cx="36" cy="28" r="1.8" fill="#333"/><circle cx="44" cy="28" r="1.8" fill="#333"/><path d="M37 33 Q40 36 43 33" stroke="#d4883a" stroke-width="1.5" fill="none" stroke-linecap="round"/><path d="M30 22 Q34 14 40 16 Q46 14 50 22" fill="#5b3a1a"/><rect x="32" y="42" width="16" height="24" rx="6" fill="#48b265"/></svg>`
      },
      {
        english: "Sister",
        chinese: "姐姐/妹妹",
        pinyin: "jiějie / mèimei",
        hint: "A girl in your family.",
        phrase: "My sister is kind.",
        svg: `<svg width="96" height="96" viewBox="0 0 80 80"><circle cx="40" cy="28" r="12" fill="#ffe0bd"/><circle cx="36" cy="26" r="1.8" fill="#333"/><circle cx="44" cy="26" r="1.8" fill="#333"/><path d="M37 31 Q40 34 43 31" stroke="#c96b8b" stroke-width="1.5" fill="none" stroke-linecap="round"/><path d="M28 22 Q30 12 40 14 Q50 12 52 22 L50 28 Q48 18 40 20 Q32 18 30 28 Z" fill="#6b3a5a"/><rect x="32" y="40" width="16" height="22" rx="6" fill="#d65db1"/></svg>`
      },
      {
        english: "Family",
        chinese: "家庭",
        pinyin: "jiātíng",
        hint: "All your loved ones together.",
        phrase: "I love my family!",
        svg: `<svg width="96" height="96" viewBox="0 0 80 80"><path d="M40 10 L60 30 L56 30 L56 55 L24 55 L24 30 L20 30 Z" fill="#c9784e" stroke="#a0603a" stroke-width="1"/><rect x="28" y="32" width="8" height="8" rx="1" fill="#87ceeb"/><rect x="44" y="32" width="8" height="8" rx="1" fill="#87ceeb"/><rect x="36" y="42" width="8" height="13" rx="1" fill="#8b5e3c"/></svg>`
      },
      {
        english: "Good Morning!",
        chinese: "早上好！",
        pinyin: "zǎoshang hǎo!",
        hint: "You say this when you wake up.",
        phrase: "Good morning, everyone!",
        svg: `<svg width="96" height="96" viewBox="0 0 80 80"><circle cx="40" cy="40" r="16" fill="#ffd700"/><circle cx="36" cy="37" r="2" fill="#333"/><circle cx="44" cy="37" r="2" fill="#333"/><path d="M34 44 Q40 50 46 44" stroke="#f4a836" stroke-width="2" fill="none" stroke-linecap="round"/></svg>`
      }
    ];

    // ===== STATE =====
    let mode = "learn";
    let currentIndex = 0;
    let flipped = false;

    let score = 0;
    let streak = 0;
    let stars = 0;

    // Match
    let matchPick = null; // { side:'en'|'zh', id }
    let matchedIds = new Set();

    // ===== ELEMENTS =====
    const badgeProgress = document.getElementById("badgeProgress");
    const badgeScore = document.getElementById("badgeScore");
    const statStars = document.getElementById("statStars");
    const statStreak = document.getElementById("statStreak");

    const modeLearnBtn = document.getElementById("modeLearn");
    const modeQuizBtn = document.getElementById("modeQuiz");
    const modeMatchBtn = document.getElementById("modeMatch");

    const panelTitle = document.getElementById("panelTitle");
    const panelSub = document.getElementById("panelSub");

    const learnSection = document.getElementById("learnSection");
    const quizSection = document.getElementById("quizSection");
    const matchSection = document.getElementById("matchSection");

    const inner = document.getElementById("inner");
    const cardSvg = document.getElementById("cardSvg");
    const enWord = document.getElementById("enWord");
    const zhWord = document.getElementById("zhWord");
    const pyWord = document.getElementById("pyWord");
    const enBack = document.getElementById("enBack");
    const phrase = document.getElementById("phrase");

    const counter = document.getElementById("counter");
    const dots = document.getElementById("dots");
    const hintLine = document.getElementById("hintLine");
    const learnFeedback = document.getElementById("learnFeedback");

    const btnPrev = document.getElementById("btnPrev");
    const btnNext = document.getElementById("btnNext");
    const btnSpeak = document.getElementById("btnSpeak");
    const btnHint = document.getElementById("btnHint");

    const quizSvg = document.getElementById("quizSvg");
    const quizPrompt = document.getElementById("quizPrompt");
    const quizOptions = document.getElementById("quizOptions");
    const quizFeedback = document.getElementById("quizFeedback");
    const btnQuizNext = document.getElementById("btnQuizNext");

    const colEn = document.getElementById("colEn");
    const colZh = document.getElementById("colZh");
    const matchFeedback = document.getElementById("matchFeedback");
    const btnMatchReset = document.getElementById("btnMatchReset");
    const btnMatchNew = document.getElementById("btnMatchNew");

    // ===== SPEECH =====
    function speak(text){
      try{
        const u = new SpeechSynthesisUtterance(text);
        u.lang = "en-US";
        u.rate = 0.92;
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      }catch(e){}
    }

    // ===== UI =====
    function updateTop(){
      badgeProgress.textContent = `${currentIndex + 1} / ${vocabulary.length}`;
      badgeScore.textContent = `Score: ${score}`;
      statStreak.textContent = `Streak: ${streak}`;
      statStars.textContent = "Stars: " + "★".repeat(stars).padEnd(5, "☆");
      counter.textContent = `${currentIndex + 1} / ${vocabulary.length}`;
    }

    function awardStar(){
      stars = Math.min(5, stars + 1);
    }

    function resetFeedback(){
      learnFeedback.textContent = "";
      learnFeedback.className = "feedback";
      quizFeedback.textContent = "";
      quizFeedback.className = "feedback";
      matchFeedback.textContent = "";
      matchFeedback.className = "feedback";
    }

    function setMode(newMode){
      mode = newMode;
      modeLearnBtn.classList.toggle("active", mode==="learn");
      modeQuizBtn.classList.toggle("active", mode==="quiz");
      modeMatchBtn.classList.toggle("active", mode==="match");

      learnSection.style.display = mode==="learn" ? "block" : "none";
      quizSection.style.display = mode==="quiz" ? "block" : "none";
      matchSection.style.display = mode==="match" ? "block" : "none";

      resetFeedback();

      if(mode==="learn"){
        panelTitle.textContent = "Learn";
        panelSub.textContent = "Tap the card to flip. Use Listen to hear.";
        renderLearn();
      }else if(mode==="quiz"){
        panelTitle.textContent = "Quiz";
        panelSub.textContent = "Choose the correct English word.";
        startQuiz();
      }else{
        panelTitle.textContent = "Match";
        panelSub.textContent = "Match English with Chinese.";
        startMatch();
      }
    }

    // ===== Learn =====
    function renderDots(){
      dots.innerHTML = "";
      vocabulary.forEach((_, i)=>{
        const d = document.createElement("div");
        d.className = "dot" + (i===currentIndex ? " active" : "");
        d.title = `Card ${i+1}`;
        d.onclick = ()=>{ currentIndex = i; renderLearn(); };
        dots.appendChild(d);
      });
    }

    function setFlip(isFlip){
      flipped = isFlip;
      inner.classList.toggle("flipped", flipped);
    }

    function renderLearn(){
      const w = vocabulary[currentIndex];
      cardSvg.innerHTML = w.svg;
      enWord.textContent = w.english;
      zhWord.textContent = w.chinese;
      pyWord.textContent = w.pinyin;
      enBack.textContent = w.english;
      phrase.textContent = `"${w.phrase}"`;
      hintLine.textContent = "Tip: Click Listen";
      setFlip(false);
      renderDots();
      updateTop();
    }

    function flip(){ setFlip(!flipped); }

    // ===== Quiz =====
    let quizAnswer = null;
    let quizLocked = false;

    function pickOtherIndexes(correctIdx, n){
      const idxs = [];
      for(let i=0;i<vocabulary.length;i++){
        if(i!==correctIdx) idxs.push(i);
      }
      idxs.sort(()=>Math.random()-0.5);
      return idxs.slice(0,n);
    }

    function startQuiz(){
      quizLocked = false;
      btnQuizNext.style.display = "none";

      const correctIdx = Math.floor(Math.random()*vocabulary.length);
      const w = vocabulary[correctIdx];
      quizAnswer = w.english;

      quizSvg.innerHTML = w.svg;
      quizPrompt.textContent = w.english;

      const options = [w.english, ...pickOtherIndexes(correctIdx, 3).map(i=>vocabulary[i].english)];
      options.sort(()=>Math.random()-0.5);

      quizOptions.innerHTML = "";
      options.forEach(opt=>{
        const b = document.createElement("button");
        b.type="button";
        b.className = "option";
        b.textContent = opt;
        b.onclick = ()=> onQuiz(opt, b);
        quizOptions.appendChild(b);
      });

      updateTop();
    }

    function onQuiz(opt, btn){
      if(quizLocked) return;
      quizLocked = true;

      const buttons = [...quizOptions.querySelectorAll("button")];
      buttons.forEach(b=>b.disabled=true);

      if(opt === quizAnswer){
        btn.classList.add("good");
        score += 10;
        streak += 1;
        if(streak % 2 === 0) awardStar();
        quizFeedback.textContent = "Correct!";
        quizFeedback.className = "feedback good";
        speak(quizAnswer);
      }else{
        btn.classList.add("bad");
        streak = 0;
        score = Math.max(0, score - 2);
        quizFeedback.textContent = `Not quite. Correct: ${quizAnswer}`;
        quizFeedback.className = "feedback bad";
        speak(quizAnswer);
        buttons.forEach(b=>{
          if(b.textContent === quizAnswer) b.classList.add("good");
        });
      }

      updateTop();
      btnQuizNext.style.display = "inline-flex";
    }

    // ===== Match =====
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function startMatch(){
      matchedIds = new Set();
      matchPick = null;

      const items = vocabulary.map((w, i)=>({ id:i, en:w.english, zh:w.chinese }));
      const left = shuffle(items);
      const right = shuffle(items);

      colEn.innerHTML = "";
      colZh.innerHTML = "";

      left.forEach(it=>{
        const b = document.createElement("button");
        b.type="button";
        b.className = "m-btn";
        b.textContent = it.en;
        b.dataset.id = it.id;
        b.onclick = ()=>pickMatch("en", it.id, b);
        colEn.appendChild(b);
      });

      right.forEach(it=>{
        const b = document.createElement("button");
        b.type="button";
        b.className = "m-btn";
        b.textContent = it.zh;
        b.dataset.id = it.id;
        b.onclick = ()=>pickMatch("zh", it.id, b);
        colZh.appendChild(b);
      });

      updateTop();
    }

    function clearSelected(){
      document.querySelectorAll(".m-btn").forEach(b=> b.classList.remove("selected"));
    }

    function markMatched(id){
      document.querySelectorAll(`.m-btn[data-id="${id}"]`).forEach(b=>{
        b.classList.remove("selected");
        b.classList.add("matched");
        b.disabled = true;
      });
    }

    function pickMatch(side, id, btn){
      if(btn.classList.contains("matched")) return;

      clearSelected();
      btn.classList.add("selected");

      if(!matchPick){
        matchPick = { side, id };
        return;
      }

      if(matchPick.side === side){
        matchPick = { side, id };
        return;
      }

      const ok = matchPick.id === id;

      if(ok){
        score += 8;
        streak += 1;
        if(streak % 2 === 0) awardStar();
        matchFeedback.textContent = "Matched!";
        matchFeedback.className = "feedback good";
        markMatched(id);
        speak(vocabulary[id].english);
        matchedIds.add(id);

        if(matchedIds.size === vocabulary.length){
          matchFeedback.textContent = "All matched. Great job!";
          matchFeedback.className = "feedback good";
        }
      }else{
        streak = 0;
        score = Math.max(0, score - 2);
        matchFeedback.textContent = "Not a match. Try again.";
        matchFeedback.className = "feedback bad";
      }

      matchPick = null;
      updateTop();
    }

    // ===== EVENTS =====
    modeLearnBtn.onclick = ()=>setMode("learn");
    modeQuizBtn.onclick = ()=>setMode("quiz");
    modeMatchBtn.onclick = ()=>setMode("match");

    document.getElementById("frontFace").onclick = flip;
    document.getElementById("backFace").onclick = flip;

    document.getElementById("frontFace").addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") flip(); });
    document.getElementById("backFace").addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") flip(); });

    btnPrev.onclick = ()=>{
      if(mode !== "learn") return;
      currentIndex = (currentIndex - 1 + vocabulary.length) % vocabulary.length;
      renderLearn();
    };

    btnNext.onclick = ()=>{
      if(mode !== "learn") return;
      currentIndex = (currentIndex + 1) % vocabulary.length;
      renderLearn();
    };

    btnSpeak.onclick = ()=>{
      const w = vocabulary[currentIndex];
      speak(w.english);
    };

    btnHint.onclick = ()=>{
      const w = vocabulary[currentIndex];
      score = Math.max(0, score - 5);
      learnFeedback.textContent = "Hint: " + w.hint;
      learnFeedback.className = "feedback";
      updateTop();
    };

    btnQuizNext.onclick = ()=> startQuiz();
    btnMatchReset.onclick = ()=> startMatch();
    btnMatchNew.onclick = ()=> startMatch();

    // INIT
    renderLearn();
    setMode("learn");
  </script>
</body>
</html>
