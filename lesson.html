<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson â€” LinguaLab</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary: #22d3ee;
            --primary-light: #ecfeff;
            --accent: #f97316;
            --navy: #1f4e79;
            --bg: #f8fafc;
            --white: #ffffff;
            --radius: 24px; /* Ğ•Ğ´Ğ¸Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ´Ğ¸ÑƒÑ Ñ exercises.html */
            --green: #10b981;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: #0f172a;
            line-height: 1.6;
            padding-top: 80px;
            padding-bottom: 100px;
        }

        /* --- ICONS --- */
        .icon { width: 20px; height: 20px; fill: currentColor; vertical-align: middle; }
        .icon-lg { width: 40px; height: 40px; fill: currentColor; }

        /* --- NAVBAR (Identical) --- */
        .navbar {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px 40px; background: #fff; box-shadow: 0 4px 20px rgba(0,0,0,.05);
            height: 80px;
        }
        .navbar-left { display: flex; align-items: center; gap: 12px; }
        .nav-logo { height: 40px; width: auto; display: block; }
        .nav-title { font-size: 24px; font-weight: 800; color: var(--navy); }
        .navbar-right { display: flex; align-items: center; gap: 20px; }
        .navbar-right a { 
            color: var(--navy); font-weight: 600; text-decoration: none; 
            font-size: 14px; transition: 0.3s; 
        }
        .navbar-right a:hover { color: var(--primary); }

        /* --- HERO (Identical) --- */
        .hero-compact {
            width: 100%;
            padding: 60px 20px 160px;
            text-align: center;
            background: linear-gradient(135deg, #22d3ee, #a78bfa);
            color: #fff;
            position: relative;
        }
        .hero-compact h1 { font-size: 42px; font-weight: 800; margin-bottom: 10px; }
        .hero-info { font-size: 18px; opacity: 0.95; }

        /* --- CONTAINER --- */
        .content-wrapper {
            max-width: 800px; /* Ğ§Ğ¸Ñ‚Ğ°Ğ±ĞµĞ»ÑŒĞ½Ğ°Ñ ÑˆĞ¸Ñ€Ğ¸Ğ½Ğ° Ğ´Ğ»Ñ ÑƒÑ€Ğ¾ĞºĞ° */
            margin: -100px auto 50px;
            position: relative;
            z-index: 10;
            padding: 0 20px;
        }

        /* --- UI ELEMENTS --- */
        .back-btn-wrapper { text-align: center; margin-bottom: 30px; }
        .back-btn { 
            display: inline-flex; align-items: center; text-decoration: none; 
            color: var(--navy); font-weight: 700; gap: 8px; font-size: 14px;
            background: rgba(255,255,255,0.95); padding: 12px 25px; border-radius: 99px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: 0.3s;
        }
        .back-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }

        /* Header Card */
        .lesson-header-card { 
            background: white; border-radius: var(--radius); padding: 40px; 
            margin-bottom: 30px; text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.08); border: 1px solid #e2e8f0;
        }
        .lesson-tag { 
            background: #f1f5f9; color: var(--navy); padding: 6px 12px; 
            border-radius: 8px; font-size: 12px; font-weight: 800; 
            text-transform: uppercase; letter-spacing: 1px; display: inline-block; margin-bottom: 15px;
        }
        .lesson-title { font-size: 32px; font-weight: 800; color: var(--navy); margin: 0 0 10px 0; }
        .lesson-goal { font-size: 16px; color: #64748b; margin-top: 10px; }

        /* Step Card */
        .step-card { 
            background: white; border-radius: 20px; padding: 35px; margin-bottom: 25px; 
            border: 1px solid #e2e8f0; position: relative; overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.02);
        }
        
        .badge {
            display: inline-flex; align-items: center; gap: 6px;
            font-size: 11px; font-weight: 800; text-transform: uppercase; 
            color: #fff; padding: 6px 12px; border-radius: 6px;
            margin-bottom: 15px; letter-spacing: 0.5px;
        }
        .bg-blue { background: #3b82f6; }
        .bg-purple { background: #8b5cf6; }
        .bg-orange { background: #f97316; }
        .bg-green { background: #10b981; }
        .bg-red { background: #ef4444; }
        .bg-gray { background: #64748b; }

        .step-title { font-weight: 800; color: var(--navy); font-size: 20px; margin-bottom: 8px; }
        .step-content-en { font-size: 18px; color: #0f172a; font-weight: 600; margin-bottom: 4px; }
        .step-content-zh { font-size: 15px; color: #64748b; }

        /* Flashcards */
        .flashcards-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px; margin-top: 20px;
        }
        .flashcard {
            background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 16px;
            padding: 20px; text-align: center; cursor: pointer; transition: 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 140px; position: relative; overflow: hidden;
        }
        .flashcard:hover { border-color: var(--primary); background: var(--primary-light); transform: translateY(-3px); }
        .flashcard-img { width: 60px; height: 60px; object-fit: contain; margin-bottom: 10px; }
        .flashcard-word { font-weight: 800; color: var(--navy); font-size: 16px; }
        .flashcard-zh { font-size: 13px; color: #64748b; margin-top: 2px; }

        /* Special Boxes */
        .mission-box {
            background: #ecfdf5; border: 1px solid #a7f3d0; padding: 20px; 
            border-radius: 12px; margin-top: 15px; display: flex; gap: 15px; align-items: flex-start;
        }
        .tip-box {
            background: #f8fafc; border-left: 4px solid #94a3b8; padding: 15px 20px; 
            margin-top: 15px; color: #475569; font-size: 14px; font-style: italic; border-radius: 4px;
        }

        /* Audio Recorder */
        .recorder-wrapper {
            background: #fff7ed; border: 1px solid #fed7aa; padding: 20px;
            border-radius: 16px; margin-top: 20px; display: flex; align-items: center; gap: 20px;
        }
        .rec-btn {
            width: 56px; height: 56px; border-radius: 50%; border: none;
            background: #ef4444; color: white; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3); transition: 0.2s;
        }
        .rec-btn:hover { transform: scale(1.1); }
        .rec-btn.recording { animation: pulse 1.5s infinite; background: #b91c1c; }
        
        .listen-btn {
            background: white; border: 2px solid var(--primary); color: var(--navy);
            padding: 8px 16px; border-radius: 99px; font-weight: 700; cursor: pointer;
            font-size: 13px; display: inline-flex; align-items: center; gap: 6px;
            margin-top: 5px;
        }
        .listen-btn:hover { background: var(--primary-light); }

        /* Footer */
        .complete-btn {
            background: var(--navy); color: white; border: none; padding: 20px;
            border-radius: 16px; font-size: 18px; font-weight: 800; cursor: pointer;
            width: 100%; margin-top: 30px; display: flex; justify-content: center; align-items: center; gap: 10px;
            box-shadow: 0 10px 20px rgba(31, 78, 121, 0.15); transition: 0.2s;
        }
        .complete-btn:hover { background: #334155; transform: translateY(-3px); }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; padding: 50px; border-radius: 30px; text-align: center; max-width: 400px; width: 90%; box-shadow: 0 20px 50px rgba(0,0,0,0.2); animation: pop 0.4s ease; }
        
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); } }

        @media (max-width: 600px) {
            .navbar { padding: 10px 20px; flex-direction: column; gap: 10px; height: auto; }
            .navbar-right { width: 100%; justify-content: center; flex-wrap: wrap; border-top: 1px solid #f1f5f9; padding-top: 10px; }
            .hero-compact h1 { font-size: 32px; }
            .content-wrapper { margin-top: -80px; }
            .flashcards-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="navbar-left">
        <img src="assets/img/logo.png" alt="LL" class="nav-logo" onerror="this.style.display='none'">
        <span class="nav-title">LinguaLab</span>
    </div>
    <div class="navbar-right">
        <a href="index.html">Main Page</a>
        <a href="grammar.html">Grammar Magic</a>
        <a href="vocabulary.html">Word Bank</a>
        <a href="parents.html">Parents Wiki</a>
    </div>
</nav>

<section class="hero-compact">
    <h1>Lesson Time</h1>
    <div class="hero-info">Ready to learn? Let's go!</div>
</section>

<div class="content-wrapper">
    <div class="back-btn-wrapper">
        <a href="exercises.html" class="back-btn">
            <svg class="icon" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            Back to Dashboard
        </a>
    </div>

    <div id="lesson-container">
        </div>
</div>

<div class="modal-overlay" id="success-modal">
    <div class="modal-content">
        <div style="font-size: 60px; margin-bottom: 20px;">ğŸŒŸ</div>
        <h2 style="color: var(--navy); margin-bottom: 10px;">Excellent Work!</h2>
        <p style="color: #64748b;">You finished the lesson.</p>
        <button class="complete-btn" style="margin-top: 25px;" onclick="window.location.href='exercises.html'">Back to Menu</button>
    </div>
</div>

<script>
    // --- ICONS (SVG) ---
    const ICON_AUDIO = '<svg class="icon" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>';
    const ICON_MIC = '<svg class="icon" viewBox="0 0 24 24"><path fill="white" d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path fill="white" d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>';
    const ICON_CHECK = '<svg class="icon" viewBox="0 0 24 24"><path fill="white" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
    const ICON_HOME = '<svg class="icon" style="color:#059669" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>';

    // --- DATABASE (Corrected & Expanded based on PDF) ---
    const db = {
        "Sep": [
            {
                title: "Greetings", tag: "Unit 1: Family",
                goal: "Learning to say hello and identify parents.",
                steps: [
                    { type: "vocab", title: "Key Words", items: [{w:"Daddy", zh:"çˆ¸çˆ¸"}, {w:"Mommy", zh:"åª½åª½"}, {w:"Family", zh:"å®¶åº­"}] },
                    { type: "action", title: "Action (TPR)", en: "Hug Daddy! Kiss Mommy!", zh: "æ“æŠ±çˆ¸çˆ¸ï¼è¦ªå»åª½åª½ï¼" },
                    { type: "speak", title: "Speaking Challenge", phrase: "Good morning, Daddy." },
                    { type: "mission", title: "Real World Mission", en: "Find a photo of your family and say 'Family'!", zh: "æ‰¾ä¸€å¼µå…¨å®¶ç¦ç…§ç‰‡ä¸¦èªª 'Family'ï¼" },
                    { type: "tip", title: "Parent Tip", en: "Don't correct pronunciation yet. Praise any effort!", zh: "ä¸è¦ç³¾æ­£ç™¼éŸ³ï¼Œå¤šé¼“å‹µå­©å­é–‹å£ã€‚" }
                ]
            },
            {
                title: "School Objects", tag: "Unit 2: School",
                goal: "Identify classroom objects.",
                steps: [
                    { type: "vocab", title: "New Words", items: [{w:"Bag", zh:"æ›¸åŒ…"}, {w:"Book", zh:"æ›¸æœ¬"}, {w:"Teacher", zh:"è€å¸«"}] },
                    { type: "action", title: "Action (TPR)", en: "Open your book. Close your book.", zh: "æ‰“é–‹æ›¸ã€‚åˆä¸Šæ›¸ã€‚" },
                    { type: "speak", title: "Speaking Challenge", phrase: "It is a book." },
                    { type: "mission", title: "Real World Mission", en: "Put a book inside a bag.", zh: "æŠŠæ›¸æ”¾é€²æ›¸åŒ…è£¡ã€‚" },
                    { type: "tip", title: "Parent Tip", en: "Use gestures when you speak English.", zh: "èªªè‹±èªæ™‚å¤šç”¨æ‰‹å‹¢è¼”åŠ©ã€‚" }
                ]
            },
            {
                title: "Phonics Bb", tag: "Unit 2: Phonics",
                goal: "Learn the letter B sound /b/.",
                steps: [
                    { type: "vocab", title: "B Words", items: [{w:"Bb", zh:"/b/ Sound"}, {w:"Ball", zh:"çƒ"}, {w:"Baby", zh:"å¬°å…’"}] },
                    { type: "speak", title: "Speaking Challenge", phrase: "Open your book." },
                    { type: "mission", title: "Real World Mission", en: "Find something Blue at home.", zh: "åœ¨å®¶è£¡æ‰¾ä¸€å€‹è—è‰²(Blue)çš„æ±è¥¿ã€‚" },
                    { type: "tip", title: "Parent Tip", en: "Emphasize the 'b' sound: b-b-book.", zh: "å¼·èª¿ b çš„ç™¼éŸ³ï¼šb-b-bookã€‚" }
                ]
            },
            {
                title: "Review", tag: "Revision 1",
                goal: "Review Units 1 & 2.",
                steps: [
                    { type: "vocab", title: "Review Words", items: [{w:"Mike", zh:"Boy"}, {w:"Kelly", zh:"Girl"}, {w:"Miss Wang", zh:"Teacher"}] },
                    { type: "speak", title: "Speaking Challenge", phrase: "Hello, I am Mike." },
                    { type: "mission", title: "Real World Mission", en: "High-five your mommy/daddy!", zh: "è·Ÿçˆ¸çˆ¸/åª½åª½æ“ŠæŒï¼" },
                    { type: "tip", title: "Parent Tip", en: "Roleplay is great for review.", zh: "è§’è‰²æ‰®æ¼”æ˜¯æœ€å¥½çš„è¤‡ç¿’æ–¹å¼ã€‚" }
                ]
            }
        ],
        "Oct": [
            {
                title: "Boy or Girl?", tag: "Unit 3: Friends",
                goal: "Understand gender (Boy/Girl).",
                steps: [
                    { type: "vocab", title: "Gender", items: [{w:"Boy", zh:"ç”·å­©"}, {w:"Girl", zh:"å¥³å­©"}, {w:"Friend", zh:"æœ‹å‹"}] },
                    { type: "action", title: "Action (TPR)", en: "Stand up! Sit down!", zh: "èµ·ç«‹ï¼åä¸‹ï¼" },
                    { type: "speak", title: "Speaking Challenge", phrase: "I am a girl." },
                    { type: "mission", title: "Real World Mission", en: "Count how many boys are in your family.", zh: "æ•¸æ•¸å®¶è£¡æœ‰å¹¾å€‹ç”·ç”Ÿã€‚" },
                    { type: "tip", title: "Parent Tip", en: "Use photos to practice he/she.", zh: "ç”¨ç…§ç‰‡ç·´ç¿’ä»–/å¥¹ã€‚" }
                ]
            },
            {
                title: "Phonics Gg", tag: "Unit 3: Phonics",
                goal: "Learn Letter G /g/.",
                steps: [
                    { type: "vocab", title: "G Words", items: [{w:"Gg", zh:"/g/"}, {w:"Girl", zh:"å¥³å­©"}, {w:"Game", zh:"éŠæˆ²"}] },
                    { type: "speak", title: "Speaking Challenge", phrase: "Stand up, please." },
                    { type: "mission", title: "Real World Mission", en: "Play a quick game of tag.", zh: "ç©ä¸€å€‹ç°¡å–®çš„æŠ“äººéŠæˆ²ã€‚" },
                    { type: "tip", title: "Parent Tip", en: "G sounds like 'guh'.", zh: "G ç™¼éŸ³åƒ 'guh'ã€‚" }
                ]
            }
        ],
        "Nov": [
            {
                title: "My Face", tag: "Unit 4: Face",
                goal: "Learn face parts.",
                steps: [
                    { type: "vocab", title: "Face Parts", items: [{w:"Eye", zh:"çœ¼ç›"}, {w:"Nose", zh:"é¼»å­"}, {w:"Mouth", zh:"å˜´å·´"}] },
                    { type: "action", title: "Action (TPR)", en: "Touch your nose!", zh: "æ‘¸æ‘¸ä½ çš„é¼»å­ï¼" },
                    { type: "speak", title: "Speaking Challenge", phrase: "This is my nose." },
                    { type: "mission", title: "Real World Mission", en: "Look in a mirror and touch your eyes.", zh: "ç…§é¡å­ä¸¦æ‘¸æ‘¸çœ¼ç›ã€‚" },
                    { type: "tip", title: "Parent Tip", en: "Play Simon Says: 'Touch your...'", zh: "ç© Simon Says éŠæˆ²ã€‚" }
                ]
            },
            {
                title: "Phonics Mm", tag: "Unit 4: Phonics",
                goal: "Learn Letter M /m/.",
                steps: [
                    { type: "vocab", title: "M Words", items: [{w:"Mm", zh:"/m/"}, {w:"Monkey", zh:"çŒ´å­"}, {w:"Mouth", zh:"å˜´å·´"}] },
                    { type: "speak", title: "Speaking Challenge", phrase: "Close your eyes." },
                    { type: "mission", title: "Real World Mission", en: "Eat something yummy and say 'Mmm'!", zh: "åƒé»å¥½åƒçš„ä¸¦èªª 'Mmm'ï¼" },
                    { type: "tip", title: "Parent Tip", en: "Make funny faces together.", zh: "ä¸€èµ·åšé¬¼è‡‰ã€‚" }
                ]
            }
        ],
        "Dec": [
            {
                title: "On the Farm", tag: "Unit 5: Farm",
                goal: "Farm animals vocabulary.",
                steps: [
                    { type: "vocab", title: "Animals", items: [{w:"Cow", zh:"ç‰›"}, {w:"Pig", zh:"è±¬"}, {w:"Duck", zh:"é´¨"}] },
                    { type: "speak", title: "Speaking Challenge", phrase: "It is a cow." },
                    { type: "mission", title: "Real World Mission", en: "Draw a pig on paper.", zh: "åœ¨ç´™ä¸Šç•«ä¸€éš»è±¬ã€‚" },
                    { type: "tip", title: "Parent Tip", en: "Make animal sounds: Moo! Oink!", zh: "æ¨¡ä»¿å‹•ç‰©å«è²ã€‚" }
                ]
            },
            {
                title: "Counting", tag: "Unit 5: Math",
                goal: "Numbers 1-3.",
                steps: [
                    { type: "vocab", title: "Numbers", items: [{w:"One", zh:"1"}, {w:"Two", zh:"2"}, {w:"Three", zh:"3"}] },
                    { type: "action", title: "Action (TPR)", en: "Show me 3 fingers.", zh: "ä¼¸å‡º3æ ¹æ‰‹æŒ‡ã€‚" },
                    { type: "speak", title: "Speaking Challenge", phrase: "One, two, three." },
                    { type: "mission", title: "Real World Mission", en: "Count 3 toys.", zh: "æ•¸3å€‹ç©å…·ã€‚" },
                    { type: "tip", title: "Parent Tip", en: "Count steps when walking.", zh: "èµ°è·¯æ™‚æ•¸æ­¥æ•¸ã€‚" }
                ]
            }
        ],
        "Jan": [
            {
                title: "At the Zoo", tag: "Unit 6: Zoo",
                goal: "Wild animals.",
                steps: [
                    { type: "vocab", title: "Wild Animals", items: [{w:"Panda", zh:"ç†Šè²“"}, {w:"Tiger", zh:"è€è™"}, {w:"Bear", zh:"ç†Š"}] },
                    { type: "speak", title: "Speaking Challenge", phrase: "Four pandas." },
                    { type: "mission", title: "Real World Mission", en: "Roar like a tiger!", zh: "åƒè€è™ä¸€æ¨£å¼å«ï¼" },
                    { type: "tip", title: "Parent Tip", en: "Pretend to be animals.", zh: "å‡è£æˆå„ç¨®å‹•ç‰©ã€‚" }
                ]
            },
            {
                title: "Phonics Tt", tag: "Unit 6: Phonics",
                goal: "Letter T /t/.",
                steps: [
                    { type: "vocab", title: "T Words", items: [{w:"Tiger", zh:"è€è™"}, {w:"Tea", zh:"èŒ¶"}, {w:"Table", zh:"æ¡Œå­"}] },
                    { type: "speak", title: "Speaking Challenge", phrase: "Take a photo." },
                    { type: "mission", title: "Real World Mission", en: "Pretend to drink tea.", zh: "å‡è£å–èŒ¶ã€‚" },
                    { type: "tip", title: "Parent Tip", en: "T sound is sharp: T-t-tiger.", zh: "T æ˜¯æ¸…è„†çš„éŸ³ã€‚" }
                ]
            }
        ],
        "Feb": [
            {
                title: "Transport", tag: "Unit 7: Transport",
                goal: "Vehicles vocabulary.",
                steps: [
                    { type: "vocab", title: "Vehicles", items: [{w:"Car", zh:"è»Š"}, {w:"Bus", zh:"å·´å£«"}, {w:"Bike", zh:"å–®è»Š"}] },
                    { type: "speak", title: "Speaking Challenge", phrase: "It is a bus." },
                    { type: "mission", title: "Real World Mission", en: "Find a wheel on a toy car.", zh: "åœ¨ç©å…·è»Šä¸Šæ‰¾è¼ªå­ã€‚" },
                    { type: "tip", title: "Parent Tip", en: "Beep beep! Make car sounds.", zh: "ç™¼å‡ºè»Šå­çš„è²éŸ³ã€‚" }
                ]
            },
            {
                title: "Phonics Cc", tag: "Unit 7: Phonics",
                goal: "Letter C /k/.",
                steps: [
                    { type: "vocab", title: "C Words", items: [{w:"Cat", zh:"è²“"}, {w:"Car", zh:"è»Š"}, {w:"Cup", zh:"æ¯å­"}] },
                    { type: "action", title: "Action (TPR)", en: "Stop! Go!", zh: "åœï¼èµ°ï¼" },
                    { type: "speak", title: "Speaking Challenge", phrase: "Stop and Go." },
                    { type: "mission", title: "Real World Mission", en: "Drink water from a cup.", zh: "ç”¨æ¯å­å–æ°´ã€‚" },
                    { type: "tip", title: "Parent Tip", en: "C makes /k/ sound like Cat.", zh: "C ç™¼ /k/ éŸ³ã€‚" }
                ]
            }
        ]
    };

    // --- RENDERER ---
    function loadLesson() {
        const params = new URLSearchParams(window.location.search);
        const month = params.get('m');
        const weekIndex = parseInt(params.get('w'));

        if (!month || !db[month] || !db[month][weekIndex]) {
            document.getElementById('lesson-container').innerHTML = `
                <div style="text-align:center; padding: 40px; background:white; border-radius:24px;">
                    <h2 style="color:var(--navy)">ğŸš§ Content Coming Soon</h2>
                    <p style="color:#64748b; margin-top:10px;">We are working on this lesson.</p>
                    <a href="exercises.html" class="back-btn" style="margin-top:20px;">Back</a>
                </div>`;
            return;
        }

        const lesson = db[month][weekIndex];

        // 1. Header
        let html = `
            <div class="lesson-header-card">
                <span class="lesson-tag">${lesson.tag}</span>
                <h1 class="lesson-title">${lesson.title}</h1>
                <div class="lesson-subtitle">${month} â€¢ Week ${weekIndex + 1}</div>
                <div class="lesson-goal">${lesson.goal}</div>
            </div>
        `;

        // 2. Steps
        lesson.steps.forEach(step => {
            html += `<div class="step-card">`;
            
            // Badge
            let badgeClass = 'bg-blue';
            if(step.type === 'action') badgeClass = 'bg-orange';
            if(step.type === 'speak') badgeClass = 'bg-red';
            if(step.type === 'mission') badgeClass = 'bg-green';
            if(step.type === 'tip') badgeClass = 'bg-gray';
            
            html += `<span class="badge ${badgeClass}">${step.type.toUpperCase()}</span>`;
            html += `<div class="step-title">${step.title}</div>`;

            // Content based on type
            if (step.type === 'vocab') {
                html += `<div class="flashcards-grid">`;
                step.items.forEach(item => {
                    // Check if image exists (placeholder logic)
                    let imgHtml = item.img ? `<img src="${item.img}" class="flashcard-img">` : `<div style="font-size:30px; margin-bottom:10px;">ğŸ“</div>`;
                    
                    html += `
                        <div class="flashcard" onclick="speak('${item.w}')">
                            ${imgHtml}
                            <div class="flashcard-word">${item.w}</div>
                            <div class="flashcard-zh">${item.zh}</div>
                            <div style="margin-top:5px; color:var(--primary)">${ICON_AUDIO}</div>
                        </div>
                    `;
                });
                html += `</div>`;
            } 
            else if (step.type === 'action') {
                html += `<div class="step-desc-en">${step.en}</div><div class="step-desc-zh">${step.zh}</div>`;
            }
            else if (step.type === 'speak') {
                html += `
                    <div class="audio-box">
                        <button class="rec-btn" onclick="toggleRecord(this)">${ICON_MIC}</button>
                        <div style="flex:1">
                            <strong style="color:var(--navy); display:block; margin-bottom:5px;">Tap mic & say:</strong>
                            <span style="font-size:18px; font-weight:700;">"${step.phrase}"</span><br>
                            <button class="listen-btn" onclick="speak('${step.phrase}')">${ICON_AUDIO} Listen First</button>
                        </div>
                    </div>
                `;
            }
            else if (step.type === 'mission') {
                html += `<div class="mission-box"><div style="font-size:24px;">${ICON_HOME}</div><div><div style="font-weight:700; color:#065f46">${step.en}</div><div style="font-size:14px; color:#047857">${step.zh}</div></div></div>`;
            }
            else if (step.type === 'tip') {
                html += `<div class="tip-box"><strong>ğŸ’¡ Parent Tip:</strong> ${step.en}<br><span style="font-size:13px; opacity:0.8">${step.zh}</span></div>`;
            }

            html += `</div>`;
        });

        // 3. Footer
        html += `<button class="complete-btn" onclick="finishLesson()">${ICON_CHECK} Complete Mission</button>`;

        document.getElementById('lesson-container').innerHTML = html;
    }

    // --- UTILS ---
    function speak(text) {
        if ('speechSynthesis' in window) {
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'en-US';
            msg.rate = 0.85;
            window.speechSynthesis.speak(msg);
        } else {
            alert("Audio not supported");
        }
    }

    let isRecording = false;
    function toggleRecord(btn) {
        if (!isRecording) {
            btn.classList.add('recording');
            isRecording = true;
        } else {
            btn.classList.remove('recording');
            isRecording = false;
            // Simulate Success
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.setValueAtTime(500, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
            osc.start();
            osc.stop(ctx.currentTime + 0.5);
        }
    }

    function finishLesson() {
        const modal = document.getElementById('success-modal');
        modal.style.display = 'flex';
        if (typeof confetti === 'function') {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#22d3ee', '#f97316', '#a78bfa'] });
        }
    }

    loadLesson();
</script>

</body>
</html>
