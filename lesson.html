<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson ‚Äî LinguaLab</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root { 
            --primary: #22d3ee; 
            --primary-light: #ecfeff;
            --navy: #1f4e79; 
            --bg: #f8fafc; 
            --white: #ffffff; 
            --orange: #f97316; 
            --green: #10b981;
            --radius: 24px;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #334155; padding-top: 80px; padding-bottom: 80px; }
        
        /* --- ICONS --- */
        .icon { width: 24px; height: 24px; fill: currentColor; vertical-align: text-bottom; }

        /* --- NAVBAR (Identical to Grammar/Exercises) --- */
        .navbar {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px 40px; background: #fff; box-shadow: 0 4px 20px rgba(0,0,0,.05);
            height: 80px;
        }
        .navbar-left { display: flex; align-items: center; gap: 12px; }
        .nav-logo { height: 40px; width: auto; display: block; }
        .nav-title { font-size: 24px; font-weight: 800; color: var(--navy); }
        .navbar-right { display: flex; align-items: center; gap: 20px; }
        .navbar-right a { 
            color: var(--navy); font-weight: 600; text-decoration: none; 
            font-size: 14px; transition: 0.3s;
        }
        .navbar-right a:hover { color: var(--primary); }

        /* PARENT TOGGLE (In Navbar) */
        .parent-switch {
            display: flex; align-items: center; gap: 8px; 
            background: #f1f5f9; padding: 6px 12px; border-radius: 99px; cursor: pointer; border: 1px solid #e2e8f0;
        }
        .parent-switch.active { background: var(--navy); color: white; border-color: var(--navy); }
        .switch-label { font-size: 12px; font-weight: 700; text-transform: uppercase; }

        /* --- PROGRESS BAR --- */
        .progress-container {
            position: fixed; top: 80px; left: 0; width: 100%; height: 6px; background: #e2e8f0; z-index: 999;
        }
        .progress-fill {
            height: 100%; background: var(--orange); width: 0%; transition: width 0.5s ease;
        }

        /* --- HERO (Identical dimensions) --- */
        .hero-compact {
            width: 100%;
            padding: 60px 20px 160px; /* Big padding for overlap */
            text-align: center;
            background: linear-gradient(135deg, #22d3ee, #a78bfa);
            color: #fff;
            position: relative;
        }
        .hero-compact h1 { font-size: 42px; font-weight: 800; margin-bottom: 10px; }
        .hero-info { font-size: 18px; opacity: 0.95; }

        /* --- CONTAINER --- */
        .container { 
            max-width: 700px; margin: -100px auto 0; 
            padding: 0 20px; position: relative; z-index: 10;
        }

        /* --- CARDS & SCREENS --- */
        .screen { display: none; animation: fadeUp 0.4s ease; }
        .screen.active { display: block; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: white; border-radius: var(--radius); padding: 40px;
            box-shadow: var(--shadow); margin-bottom: 30px; text-align: center;
            border: 1px solid #e2e8f0;
        }

        /* --- START SCREEN --- */
        .trust-badges { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .badge { background: #f0f9ff; color: var(--navy); padding: 5px 12px; border-radius: 6px; font-size: 12px; font-weight: 700; }
        
        .promise-box { margin: 25px 0; text-align: left; background: #f8fafc; padding: 20px; border-radius: 16px; }
        .promise-item { display: flex; gap: 10px; margin-bottom: 12px; font-size: 15px; color: #475569; align-items: center; }
        .check-icon { color: var(--green); font-weight: bold; }

        /* --- LESSON STEPS --- */
        .step-header { margin-bottom: 20px; }
        .step-tag { 
            color: var(--primary); font-weight: 800; text-transform: uppercase; 
            font-size: 12px; letter-spacing: 1px; display: block; margin-bottom: 5px;
        }
        .step-title { font-size: 28px; font-weight: 800; color: var(--navy); }
        
        /* Parent Tip Box (Hidden by default) */
        .parent-tip {
            display: none; text-align: left; background: #fff7ed; 
            border-left: 4px solid var(--orange); padding: 15px; 
            border-radius: 8px; margin-bottom: 25px; font-size: 14px; color: #9a3412;
        }
        
        /* Flashcards Grid */
        .flashcards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; margin: 20px 0; }
        .flashcard {
            background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 16px;
            padding: 15px; cursor: pointer; transition: 0.2s;
        }
        .flashcard:hover { border-color: var(--primary); background: #ecfeff; transform: scale(1.05); }
        .fc-icon { font-size: 32px; display: block; margin-bottom: 5px; }
        .fc-word { font-weight: 700; color: var(--navy); font-size: 14px; }

        /* Audio Controls */
        .audio-control {
            background: #f1f5f9; padding: 20px; border-radius: 16px; 
            display: flex; align-items: center; gap: 15px; margin: 20px 0;
        }
        .play-btn {
            width: 50px; height: 50px; border-radius: 50%; border: none; background: var(--primary); 
            color: white; cursor: pointer; display: flex; justify-content: center; align-items: center;
        }
        .mic-btn {
            width: 60px; height: 60px; border-radius: 50%; border: none; background: #ef4444; 
            color: white; cursor: pointer; display: flex; justify-content: center; align-items: center;
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3); transition: 0.2s;
        }
        .mic-btn:hover { transform: scale(1.1); }
        .mic-btn.recording { animation: pulse 1.5s infinite; background: #b91c1c; }

        /* Offscreen Mission */
        .mission-box {
            border: 2px dashed #cbd5e1; padding: 20px; border-radius: 16px; margin: 20px 0;
            background: #f8fafc; color: #475569;
        }

        /* Footer Nav */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: white; padding: 15px 20px; 
            border-top: 1px solid #e2e8f0; display: flex; gap: 10px; z-index: 1000;
            justify-content: center;
        }
        .nav-btn {
            background: var(--navy); color: white; border: none; 
            padding: 16px 32px; border-radius: 14px; font-size: 16px; 
            font-weight: 700; cursor: pointer; width: 100%; max-width: 600px;
            transition: 0.2s;
        }
        .nav-btn:hover { background: #334155; }
        .nav-btn.secondary { background: white; color: var(--navy); border: 2px solid #e2e8f0; }

        /* REPORT CARD */
        .report-list { text-align: left; margin: 20px 0; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; }
        .report-item { margin-bottom: 10px; font-size: 15px; color: #334155; display: flex; align-items: center; gap: 10px; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.6); } 70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); } }

        @media (max-width: 600px) {
            .navbar { padding: 10px 20px; height: auto; flex-direction: column; gap: 10px; }
            .navbar-right { width: 100%; justify-content: center; flex-wrap: wrap; border-top: 1px solid #f1f5f9; padding-top: 10px; }
            .hero-compact h1 { font-size: 32px; }
            .container { margin-top: -80px; }
            .progress-container { top: 110px; }
        }
    </style>
</head>
<body>

<div class="progress-container"><div class="progress-fill" id="progress-bar"></div></div>

<nav class="navbar">
    <div class="navbar-left">
        <img src="assets/img/logo.png" alt="LL" class="nav-logo" onerror="this.style.display='none'">
        <span class="nav-title">LinguaLab</span>
    </div>
    <div class="navbar-right">
        <div class="parent-switch" onclick="toggleParentMode()">
            <span class="switch-label">Parent Mode</span>
            <svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
        </div>
        <a href="exercises.html" style="margin-left:15px; font-weight:700;">Exit Lesson</a>
    </div>
</nav>

<section class="hero-compact">
    <h1>Fun Homework</h1>
    <div class="hero-info" id="hero-date">Ready to play?</div>
</section>

<div class="container">

    <div id="screen-start" class="screen active">
        <div class="card">
            <div class="trust-badges">
                <span class="badge">Ages 3‚Äì6</span>
                <span class="badge">Talk, not scroll</span>
                <span class="badge">One-click lesson</span>
            </div>
            <h2 style="font-size:32px; color:var(--navy); margin-bottom:10px;">7 minutes.<br>Press Play.<br> No prep, no teacher. </h2>
            <p style="color:#64748b; margin-bottom:20px;">We guide you step-by-step.</p>
            
            <div class="promise-box">
                <div class="promise-item"><span class="check-icon">‚úì</span> <b>Today:</b> 6 words + 1 phrase + 1 game</div>
                <div class="promise-item"><span class="check-icon">‚úì</span> <b>No battles:</b> tired day? use ‚Äú2-min mode‚Äù</div>
                <div class="promise-item"><span class="check-icon">‚úì</span> <b>Progress:</b> you‚Äôll see it today</div>
            </div>

            <button class="nav-btn" onclick="startLesson()">Play</button>
        </div>
    </div>

    <div id="screen-lesson" class="screen">
        <div class="card" id="lesson-card-content">
            </div>
        
        <div class="bottom-nav">
            <button class="nav-btn secondary" style="width:30%" onclick="prevStep()">Back</button>
            <button class="nav-btn" style="width:70%" onclick="nextStep()" id="next-btn">Next Step ‚Üí</button>
        </div>
    </div>

    <div id="screen-report" class="screen">
        <div class="card" style="border-top: 6px solid var(--green);">
            <div style="font-size:60px; margin-bottom:10px;">üèÜ</div>
            <h2 style="color:var(--navy); margin-bottom:5px;">You did it!</h2>
            <p style="color:#64748b;">You showed up ‚Äî that‚Äôs a win.</p>

            <div class="report-list">
                <div style="font-weight:800; color:var(--navy); margin-bottom:15px; text-transform:uppercase; font-size:12px;">Parent Report</div>
                <div class="report-item">
                    <svg class="icon" style="color:var(--green)" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>
                    <span><b>Learned:</b> <span id="report-vocab"></span></span>
                </div>
                <div class="report-item">
                    <svg class="icon" style="color:var(--green)" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>
                    <span><b>Spoke:</b> <span id="report-phrase"></span></span>
                </div>
                <div class="report-item">
                    <svg class="icon" style="color:var(--green)" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>
                    <span><b>Next Time:</b> Review & Play</span>
                </div>
            </div>

            <button class="nav-btn" onclick="window.location.href='exercises.html'">Back to Fun Homework</button>
        </div>
    </div>

</div>

<script>
    // --- ICONS ---
    const ICON_AUDIO = '<svg class="icon" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>';
    const ICON_PLAY = '<svg class="icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
    const ICON_MIC = '<svg class="icon" style="width:30px;height:30px" viewBox="0 0 24 24"><path fill="white" d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path fill="white" d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>';

    // --- CONTENT DB (Sep-Feb) ---
    const db = {
        "Sep": [
          {
            unit: "Unit 1: Family", vocab: "Daddy, Mommy", phrase: "Good morning Daddy",
            steps: [
              { type:'warmup', tag:'A. Warm Up', title:"Listen & Wave", text:"Let's say Hello!", action:"Wave your hand", phrase:"Hello!" },
              { type:'words', tag:'B. Key Words', title:"Family Members",
                items: [
                  { w:"Daddy",  zh:"Áà∏Áà∏", img:"assets/img/daddy.png" },
                  { w:"Mommy",  zh:"Â¶àÂ¶à", img:"assets/img/mommy.png" },
                  { w:"Family", zh:"ÂÆ∂‰∫∫", img:"assets/img/family.png" }
                ]
              },
              { type:'phrase', tag:'C. Key Sentences', title:"Phrase of the Day",
                text:"Good morning, Daddy! Good morning, Mommy!",
                script:"Ask your child: 'Who do you see in the morning?'",
                parentTip:"Don't correct pronunciation yet. Just praise effort."
              },
              { type:'game', tag:'D. Game', title:"Hug Game", text:"Run and hug Mommy or Daddy!", sub:"Ready? Go!", img:"assets/img/hug.png" },
              { type:'offscreen', tag:'E. Mission', title:"Real World", text:"Find a family photo.", img:"assets/img/photo.jpg" }
            ]
          },
        
          {
            unit: "Unit 2: School", vocab: "Bag, Book", phrase: "It is a book",
            steps: [
              { type:'warmup', tag:'A. Warm Up', title:"Stand Up!", text:"Stand up... Sit down.", action:"Do it 3 times.", phrase:"Stand up!" },
              { type:'words', tag:'B. Key Words', title:"School Objects",
                items: [
                  { w:"Bag",    zh:"‰π¶ÂåÖ", img:"assets/img/bag.png" },
                  { w:"Book",   zh:"‰π¶",   img:"assets/img/book.png" },
                  { w:"Pencil", zh:"ÈìÖÁ¨î", img:"assets/img/pencil.png" }
                ]
              },
              { type:'phrase', tag:'C. Key Sentences', title:"Phrase of the Day", text:"It is a book.", script:"Point to a book and ask: 'What is this?'", parentTip:"Say the word first, let them repeat." },
              { type:'game', tag:'D. Game', title:"Hide & Seek", text:"Hide a book. Ask: 'Where is the book?'", sub:"Child finds it.", img:"assets/img/find.png" },
              { type:'offscreen', tag:'E. Mission', title:"Real World", text:"Put a book in a bag.", img:"assets/img/book and bag.png" }
            ]
          },
        
          {
            unit: "Unit 2: Phonics", vocab: "Bb /b/", phrase: "Open book",
            steps: [
              { type:'warmup', tag:'A. Warm Up', title:"Clap Hands", text:"Clap 1, 2, 3.", action:"Clap!", phrase:"Clap!" },
              { type:'words', tag:'B. Key Words', title:"B Sound",
                items: [
                  { w:"Bb",   zh:"Â≠óÊØçB", img:"assets/img/bb.png" },
                  { w:"Ball", zh:"ÁêÉ",     img:"assets/img/ball.png" },
                  { w:"Baby", zh:"ÂÆùÂÆù",   img:"assets/img/baby.png" }
                ]
              },
              { type:'phrase', tag:'C. Action', title:"TPR Command", text:"Open your book.", script:"Model the action first.", parentTip:"Emphasize the 'b' sound in Book." },
              { type:'game', tag:'D. Game', title:"Blue Hunt", text:"Find something BLUE.", sub:"B is for Blue." },
              { type:'offscreen', tag:'E. Mission', title:"Real World", text:"Find a blue toy.", img:"assets/img/blue toy.png" }
            ]
          },
        
          {
            unit: "Revision 1", vocab: "Mike, Kelly", phrase: "Hello I am...",
            steps: [
              { type:'warmup', tag:'A. Warm Up', title:"Shake", text:"Shake your body!", action:"Shake!", phrase:"Shake!" },
              { type:'words', tag:'B. Key Words', title:"Review",
                items: [
                  { w:"What's your name?", zh:"‰Ω†Âè´‰ªÄ‰πàÂêçÂ≠óÔºü", img:"assets/img/name q.png" },
                  { w:"My name is",       zh:"ÊàëÂè´‚Ä¶",          img:"assets/img/name.png" },
                  { w:"Teacher",          zh:"ËÄÅÂ∏à",           img:"assets/img/teacher.png" }
                ]
              },
              { type:'phrase', tag:'C. Key Sentences', title:"Roleplay", text:"Hello, I am [Name].", script:"Practice with a puppet.", parentTip:"Roleplay builds confidence." },
              { type:'game', tag:'D. Game', title:"Who is it?", text:"He is Mike." },
              { type:'offscreen', tag:'E. Mission', title:"Real World", text:"Say Hello to a toy.", img:"assets/img/hello toy.png" }
            ]
          }
        ],
                "Oct": [
          {
            unit: "Unit 3: Friends", vocab: "Boy, Girl", phrase: "You are a boy",
            tips: "Use family photos to help your child understand 'He' (Boy) and 'She' (Girl).",
            steps: [
              { type:'warmup', tag:'A. Warm Up', title:"High Five", text:"High five Mommy!", action:"Say: 'Hello!'", phrase:"Hello!" },
              { type:'words', tag:'B. Key Words', title:"Gender",
                items: [
                  { w:"Boy",    zh:"Áî∑Â≠©", img:"assets/img/boy.png" },
                  { w:"Girl",   zh:"Â•≥Â≠©", img:"assets/img/girl.png" },
                  { w:"Friend", zh:"ÊúãÂèã", img:"assets/img/friend.png" }
                ]
              },
              { type:'phrase', tag:'C. Key Sentences', title:"Identity", text:"You are a boy/girl.", script:"Point to your child and say the phrase.", parentTip:"Point to yourself (I am) and the child (You are)." },
              { type:'game', tag:'D. Game', title:"Stand Up", text:"Boys stand up! Girls sit down!", sub:"Listen and do." },
              { type:'offscreen', tag:'E. Mission', title:"Real World", text:"Count how many boys are in your family.", icon:"üë®‚Äçüë©‚Äçüë¶" }
            ]
          },
        
          {
            unit: "Unit 3: Social", vocab: "My Friend", phrase: "This is my friend",
            tips: "Teach your child to introduce others politely.",
            steps: [
              { type:'warmup', tag:'A. Warm Up', title:"Handshake", text:"Shake hands.", action:"Nice to meet you.", phrase:"Hello friend." },
              { type:'words', tag:'B. Key Words', title:"Friendship",
                items: [
                  { w:"Friend",     zh:"ÊúãÂèã",     img:"assets/img/friend.png" },
                  { w:"Play",       zh:"Áé©",       img:"assets/img/play.png" },
                  { w:"Teddy Bear", zh:"Ê≥∞Ëø™ÁÜä",   img:"assets/img/teddy bear.png" }
                ]
              },
              { type:'phrase', tag:'C. Key Sentences', title:"Intro", text:"This is my friend.", script:"Introduce a toy to Mommy.", parentTip:"Use a teddy bear to practice introductions." },
              { type:'game', tag:'D. Game', title:"Draw", text:"Draw your best friend's face.", sub:"Quick sketch!" },
              { type:'offscreen', tag:'E. Mission', title:"Real World", text:"Hug your friend (or a toy).", icon:"ü§ó" }
                ]
            },
            {
                // Week 3: Unit 3 - Phonics G & TPR
                meta: { unit: "Unit 3: Phonics", vocab: "Gg /g/", phrase: "Stand up please" },
                tips: "Letter G makes the /g/ sound (hard G), not /j/.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Wiggle", text: "Wiggle your fingers.", action: "Wiggle wiggle!", phrase: "Wiggle!" },
                    { type: 'words', tag: 'B. Key Words', title: "G Sound", items: [{w:"Gg", i:"üî§"},{w:"Girl", i:"üëß"},{w:"Game", i:"üé≤"}] },
                    { type: 'phrase', tag: 'C. Action', title: "TPR Command", text: "Stand up, please.", script: "Give commands politely.", parentTip: "Add 'Please' to teach manners." },
                    { type: 'game', tag: 'D. Game', title: "Simon Says", text: "Simon says: Sit down.", sub: "Don't get tricked!" },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Play a quick game of Tag.", icon: "üèÉ" }
                ]
            },
            {
                // Week 4: Reader 1 - A Messy Family
                meta: { unit: "Reader 1", vocab: "Family, Messy", phrase: "Who is this?" },
                tips: "Reading week! Focus on the pictures in the story.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Look", text: "Open your eyes big!", action: "Look around.", phrase: "Look!" },
                    { type: 'words', tag: 'B. Key Words', title: "Story Words", items: [{w:"Messy", i:"üß∫"},{w:"Toy", i:"ü§ñ"},{w:"Cat", i:"üê±"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Question", text: "Who is this?", script: "Point to a character in the book.", parentTip: "Encourage child to answer: 'This is Daddy'." },
                    { type: 'game', tag: 'D. Game', title: "Clean Up", text: "The room is messy! Clean up!", sub: "Pick up 3 things." },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Find a toy under the bed/chair.", icon: "üîç" }
                ]
            }
        ],
        
        "Nov": [
            {
                // Week 1: Unit 4 - My Face
                meta: { unit: "Unit 4: My Face", vocab: "Eye, Nose, Mouth", phrase: "This is my nose" },
                tips: "Use a mirror so your child can see their own face while learning.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Touch Game", text: "Touch your nose!", action: "Do it fast!", phrase: "Touch your nose!" },
                    { type: 'words', tag: 'B. Key Words', title: "Face Parts", items: [{w:"Eye", i:"üëÅÔ∏è"},{w:"Nose", i:"üëÉ"},{w:"Mouth", i:"üëÑ"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Identity", text: "This is my nose.", script: "Point to your nose and say it.", parentTip: "Model the sentence first: 'This is *my* nose'." },
                    { type: 'game', tag: 'D. Game', title: "Simon Says", text: "Simon says: Touch your ear!", sub: "Don't touch if I don't say Simon Says." },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Look in a mirror and name 3 face parts.", icon: "ü™û" }
                ]
            },
            {
                // Week 2: Unit 4 - Funny Faces
                meta: { unit: "Unit 4: Creativity", vocab: "Ear, Hair", phrase: "My mouth is big" },
                tips: "Make learning fun by making silly faces together!",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Smile", text: "Big Smile! Sad face.", action: "Show me emotions.", phrase: "Smile!" },
                    { type: 'words', tag: 'B. Key Words', title: "More Parts", items: [{w:"Ear", i:"üëÇ"},{w:"Hair", i:"üíá"},{w:"Face", i:"üòÄ"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Description", text: "This is my mouth.", script: "Open your mouth wide!", parentTip: "Make it a game: Big mouth vs Small mouth." },
                    { type: 'game', tag: 'D. Game', title: "Fruit Face", text: "Make a face using fruit slices (pretend).", sub: "Banana smile?" },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Draw a funny face on paper.", icon: "üñçÔ∏è" }
                ]
            },
            {
                // Week 3: Unit 4 - Phonics Mm
                meta: { unit: "Unit 4: Phonics", vocab: "Mm /m/", phrase: "Close your eyes" },
                tips: "The /m/ sound vibrates on your lips. Mmmmmm!",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Yummy", text: "Rub your tummy.", action: "Say Mmmmmm!", phrase: "Mmmmmm!" },
                    { type: 'words', tag: 'B. Key Words', title: "M Sound", items: [{w:"Mm", i:"‚ìÇÔ∏è"},{w:"Monkey", i:"üêí"},{w:"Milk", i:"ü•õ"}] },
                    { type: 'phrase', tag: 'C. Action', title: "TPR Command", text: "Close your eyes.", script: "Open... and Close.", parentTip: "Play Peek-a-boo to practice." },
                    { type: 'game', tag: 'D. Game', title: "Monkey Act", text: "Act like a monkey!", sub: "Scratch your head and say Ooo-ooo." },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Drink some milk (or water).", icon: "ü•õ" }
                ]
            },
            {
                // Week 4: Reader 2 - Buzz! Buzz!
                meta: { unit: "Reader 2", vocab: "Bee, Hair", phrase: "Oh my hair!" },
                tips: "Read the story 'Buzz! Buzz!'. It's about a bee landing on different face parts.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Buzz", text: "Buzz like a bee...", action: "Fly around!", phrase: "Buzzzzz." },
                    { type: 'words', tag: 'B. Key Words', title: "Story Words", items: [{w:"Bee", i:"üêù"},{w:"Hair", i:"üíá"},{w:"No", i:"üö´"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Reaction", text: "Oh, my hair!", script: "Pretend a bee is on your hair.", parentTip: "Use a dramatic voice: 'Oh no!'" },
                    { type: 'game', tag: 'D. Game', title: "Bee Attack", text: "Parent is the bee. Touch child's nose.", sub: "Child says 'My nose!'" },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Find something yellow (like a bee).", icon: "üü°" }
                ]
            }
        ],
        "Dec": [
            {
                meta: { unit: "Unit 5: Farm", vocab: "Cow, Pig", phrase: "It is a cow" },
                tips: "Animal sounds are fun! Don't be afraid to be loud.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Sounds", text: "Moo! Oink!", action: "Make animal sounds.", phrase: "Moo!" },
                    { type: 'words', tag: 'B. Key Words', title: "Farm Animals", items: [{w:"Cow", i:"üêÆ"},{w:"Pig", i:"üê∑"},{w:"Duck", i:"ü¶Ü"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Phrase", text: "It is a cow.", script: "Point to a picture. Ask: What is this?", parentTip: "Encourage pointing while speaking." },
                    { type: 'game', tag: 'D. Game', title: "Sound Guess", text: "Close eyes. Parent says 'Oink'. Child guesses.", sub: "It is a pig!" },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Walk like a duck around the room.", icon: "ü¶Ü" }
                ]
            },
            {
                meta: { unit: "Unit 5: Math", vocab: "1, 2, 3", phrase: "One pig" },
                tips: "Count everything: fingers, toes, toys.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Fingers", text: "Show me 1 finger.", action: "Show me 2 fingers.", phrase: "One, two." },
                    { type: 'words', tag: 'B. Key Words', title: "Numbers", items: [{w:"One", i:"1Ô∏è‚É£"},{w:"Two", i:"2Ô∏è‚É£"},{w:"Three", i:"3Ô∏è‚É£"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Counting", text: "Look! Two pigs.", script: "Count toys together.", parentTip: "Count slowly and clearly." },
                    { type: 'game', tag: 'D. Game', title: "Count Toys", text: "Put 3 toys on the floor. Count them.", sub: "One, two, three." },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Find 3 spoons in the kitchen.", icon: "ü•Ñ" }
                ]
            },
            {
                meta: { unit: "Unit 5: Phonics P", vocab: "Pp, Pink", phrase: "Pink pig" },
                tips: "P is a 'popping' sound. Put hand in front of mouth to feel air.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Pop!", text: "Pop your cheeks!", action: "P-p-p-pop!", phrase: "Pop!" },
                    { type: 'words', tag: 'B. Key Words', title: "P Words", items: [{w:"Pp", i:"üÖøÔ∏è"},{w:"Pink", i:"ü©∑"},{w:"Pig", i:"üê∑"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Color Phrase", text: "A pink pig.", script: "Find pink things.", parentTip: "Emphasize the 'P' sound." },
                    { type: 'game', tag: 'D. Game', title: "Pink Hunt", text: "Find something PINK in the room.", sub: "Go!" },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Touch something pink.", icon: "ü©∑" }
                ]
            },
            {
                meta: { unit: "Unit 5: Review", vocab: "Animals", phrase: "I like animals" },
                tips: "Review week! Sing the song together.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Clap", text: "Clap 3 times.", action: "1, 2, 3!", phrase: "One, two, three." },
                    { type: 'words', tag: 'B. Key Words', title: "Review", items: [{w:"Hen", i:"üêî"},{w:"Cow", i:"üêÆ"},{w:"Pig", i:"üê∑"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Expression", text: "I like animals.", script: "Hug a toy animal.", parentTip: "Ask: Do you like pigs?" },
                    { type: 'game', tag: 'D. Game', title: "Act it out", text: "Act like a Hen (Cluck cluck).", sub: "Child guesses." },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Sing 'Old McDonald' together.", icon: "üé∂" }
                ]
            }
        ],
        "Jan": [
            {
                meta: { unit: "Unit 6: Zoo", vocab: "Panda, Tiger", phrase: "Look at..." },
                tips: "Use a deep voice for big animals, high voice for small ones.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Roar!", text: "Roar like a tiger!", action: "Roar!", phrase: "Roar!" },
                    { type: 'words', tag: 'B. Key Words', title: "Wild Animals", items: [{w:"Panda", i:"üêº"},{w:"Tiger", i:"üêØ"},{w:"Bear", i:"üêª"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Pointing", text: "Look at the panda.", script: "Point to the screen.", parentTip: "Use your finger to point." },
                    { type: 'game', tag: 'D. Game', title: "Walk like...", text: "Walk like a heavy bear.", sub: "Stomp stomp!" },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Find a teddy bear.", icon: "üß∏" }
                ]
            },
            {
                meta: { unit: "Unit 6: Photo", vocab: "Camera", phrase: "Take a photo" },
                tips: "Pretend your hands are a camera.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Smile", text: "Cheese! Smile big.", action: "Smile!", phrase: "Cheese!" },
                    { type: 'words', tag: 'B. Key Words', title: "Zoo Words", items: [{w:"Monkey", i:"üêí"},{w:"Photo", i:"üì∑"},{w:"Zoo", i:"ü¶Å"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Action", text: "Take a photo.", script: "Click! Pretend to take a picture.", parentTip: "Make the 'Click' sound." },
                    { type: 'game', tag: 'D. Game', title: "Freeze", text: "Dance... and FREEZE for a photo!", sub: "Don't move!" },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Take a pretend photo of Mom.", icon: "üì∏" }
                ]
            },
            {
                meta: { unit: "Unit 6: Phonics T", vocab: "Tt, Tiger", phrase: "Two tigers" },
                tips: "T is a ticking sound. T-t-t-tiger.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Tap", text: "Tap your toe.", action: "Tap tap tap.", phrase: "Tap!" },
                    { type: 'words', tag: 'B. Key Words', title: "T Words", items: [{w:"Tt", i:"‚úùÔ∏è"},{w:"Tea", i:"üçµ"},{w:"Table", i:"ü™ë"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Phrase", text: "Two tigers.", script: "Show 2 fingers.", parentTip: "The tongue behind the teeth for T." },
                    { type: 'game', tag: 'D. Game', title: "Tap Table", text: "Tap the table 3 times.", sub: "1, 2, 3." },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Touch a table.", icon: "ü™ë" }
                ]
            },
            {
                meta: { unit: "Unit 6: Rules", vocab: "Quiet", phrase: "Be quiet" },
                tips: "Practice whispering. It calms children down.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Shhh", text: "Put finger on lips.", action: "Shhh...", phrase: "Shhh." },
                    { type: 'words', tag: 'B. Key Words', title: "Rules", items: [{w:"Quiet", i:"ü§´"},{w:"Sleep", i:"üò¥"},{w:"Loud", i:"üì¢"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Polite", text: "Be quiet, please.", script: "The animals are sleeping.", parentTip: "Whisper this phrase." },
                    { type: 'game', tag: 'D. Game', title: "Sleeping Lions", text: "Lie down and don't move!", sub: "Are you sleeping?" },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Walk on tip-toes.", icon: "üë£" }
                ]
            }
        ],
        "Feb": [
            {
                meta: { unit: "Unit 7: Cars", vocab: "Car, Bus", phrase: "It is a bus" },
                tips: "Boys usually love this unit! Make engine noises.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Beep", text: "Beep Beep!", action: "Press the horn.", phrase: "Beep!" },
                    { type: 'words', tag: 'B. Key Words', title: "Vehicles", items: [{w:"Car", i:"üöó"},{w:"Bus", i:"üöå"},{w:"Bike", i:"üö≤"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Identification", text: "It is a bus.", script: "Show a toy car/bus.", parentTip: "Ask: What is it?" },
                    { type: 'game', tag: 'D. Game', title: "Driving", text: "Drive your bus around the room.", sub: "Vroom!" },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Find a wheel.", icon: "üõû" }
                ]
            },
            {
                meta: { unit: "Unit 7: Situations", vocab: "Taxi", phrase: "Oh my bike" },
                tips: "Teach emotion: 'Oh no!'",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Oh no!", text: "Hands on cheeks. Oh no!", action: "Make a sad face.", phrase: "Oh no!" },
                    { type: 'words', tag: 'B. Key Words', title: "More Vehicles", items: [{w:"Taxi", i:"üöï"},{w:"Wheel", i:"üõû"},{w:"Broken", i:"üíî"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Expression", text: "Oh, my bike!", script: "Pretend a toy is broken.", parentTip: "Use dramatic expression." },
                    { type: 'game', tag: 'D. Game', title: "Fall down", text: "Spin and fall down gently.", sub: "Oops!" },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Fix a broken toy.", icon: "üîß" }
                ]
            },
            {
                meta: { unit: "Unit 7: Phonics C", vocab: "Cc, Cat", phrase: "Stop and Go" },
                tips: "C sounds like 'K' (Cat), not 'S'.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Meow", text: "Act like a cat.", action: "Meow!", phrase: "Meow." },
                    { type: 'words', tag: 'B. Key Words', title: "C Words", items: [{w:"Cc", i:"¬©Ô∏è"},{w:"Cat", i:"üê±"},{w:"Cup", i:"‚òï"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Traffic", text: "Stop and Go.", script: "Red light, Green light.", parentTip: "Use hand signals: Palm for Stop." },
                    { type: 'game', tag: 'D. Game', title: "Red Light", text: "Run... STOP! Run... STOP!", sub: "Don't move." },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Drink water from a cup.", icon: "ü•§" }
                ]
            },
            {
                meta: { unit: "Review", vocab: "Colors", phrase: "Red light" },
                tips: "Safety lesson: Red means Stop.",
                steps: [
                    { type: 'warmup', tag: 'A. Warm Up', title: "Stop", text: "Freeze!", action: "Don't move.", phrase: "Stop!" },
                    { type: 'words', tag: 'B. Key Words', title: "Colors", items: [{w:"Red", i:"üî¥"},{w:"Green", i:"üü¢"},{w:"Yellow", i:"üü°"}] },
                    { type: 'phrase', tag: 'C. Key Sentences', title: "Safety", text: "Red light, Stop.", script: "Look at traffic lights.", parentTip: "Practice this when crossing street." },
                    { type: 'game', tag: 'D. Game', title: "Traffic Cop", text: "Parent says color, child acts.", sub: "Red=Stop, Green=Go." },
                    { type: 'offscreen', tag: 'E. Mission', title: "Real World", text: "Find something Red.", icon: "üü•" }
                ]
            }
        ]
    };

    // --- LOGIC ---
    let currentData = null;
    let stepIndex = 0;
    let isRecording = false;

    function init() {
      const params = new URLSearchParams(window.location.search);
      const m = params.get('m');
      const w = parseInt(params.get('w')) || 0;
    
      if (m && db[m] && db[m][w]) {
        currentData = db[m][w];
      } else {
        currentData = db["Sep"][0];
      }
          document.getElementById('hero-date').innerText =
        currentData.unit || currentData.meta?.unit || "Ready to play?";
    }

    function toggleParentMode() {
        const btn = document.querySelector('.parent-switch');
        btn.classList.toggle('active');
        document.querySelectorAll('.parent-tip').forEach(el => {
            el.style.display = btn.classList.contains('active') ? 'block' : 'none';
        });
    }

    function startLesson() {
        document.getElementById('screen-start').classList.remove('active');
        document.getElementById('screen-lesson').classList.add('active');
        renderStep(0);
    }

    function renderStep(idx) {
        stepIndex = idx;
        const step = currentData.steps[idx];
        const card = document.getElementById('lesson-card-content');
        
        // Progress Bar
        const pct = ((idx + 1) / currentData.steps.length) * 100;
        document.getElementById('progress-bar').style.width = pct + '%';

        // Next Button Logic
        const nextBtn = document.getElementById('next-btn');
        if (idx === currentData.steps.length - 1) {
            nextBtn.innerText = "Finish üéâ";
            nextBtn.onclick = finishLesson;
        } else {
            nextBtn.innerText = "Next Step ‚Üí";
            nextBtn.onclick = nextStep;
        }

        // Render Content based on Type
        let html = `
            <div class="step-header">
                <span class="step-tag">${step.tag}</span>
                <h2 class="step-title">${step.title}</h2>
            </div>
        `;

        // Parent Tip
        if (step.parentTip) {
            html += `<div class="parent-tip">üí° <b>Parent Tip:</b> ${step.parentTip}</div>`;
        }

        // A. WARMUP
        if (step.type === 'warmup') {
            html += `
                <div class="audio-control" style="justify-content:center; flex-direction:column; text-align:center;">
                    <button class="play-btn" onclick="speak('${step.phrase}')">${ICON_PLAY}</button>
                    <p style="font-size:18px; font-weight:600; margin:10px 0;">${step.text}</p>
                    <p style="color:#64748b;">${step.action}</p>
                </div>
            `;
        }

        // B. WORDS
        else if (step.type === 'vocab' || step.type === 'words') {
          html += `<div class="flashcards-grid">`;
          step.items.forEach(item => {
        
            const wordSafe = (item.w || '').replace(/'/g, "\\'"); // —á—Ç–æ–±—ã speak –Ω–µ –ª–æ–º–∞–ª—Å—è –Ω–∞ –∞–ø–æ—Å—Ç—Ä–æ—Ñ–∞—Ö
        
            let visual = item.img
              ? `<img src="${encodeURI(item.img)}" class="fc-img" alt="${item.w}"
                      onerror="this.onerror=null; this.src='assets/img/book.png';">`
              : `<div class="fc-icon">${item.i || ''}</div>`;
        
            html += `
              <div class="flashcard" onclick="speak('${wordSafe}')">
                ${visual}
                <div class="fc-word">${item.w}</div>
                ${item.zh ? `<div class="flashcard-zh">${item.zh}</div>` : ''}
                ${ICON_AUDIO}
              </div>`;
          });
          html += `</div>`;
        }

        // C. PHRASE / SPEAKING
        else if (step.type === 'phrase' || step.type === 'speak') {
            html += `
                <div style="background:#ecfeff; padding:20px; border-radius:12px; margin-bottom:20px; text-align:left;">
                    <div style="font-size:12px; font-weight:700; color:var(--navy); text-transform:uppercase;">Script</div>
                    <div style="font-size:16px; color:#334155;">"${step.script || step.phrase}"</div>
                </div>
                <div class="audio-control">
                    <button class="mic-btn" onclick="toggleMic(this)">${ICON_MIC}</button>
                    <div style="flex:1; text-align:left;">
                        <strong style="color:var(--navy);">Your turn:</strong><br>
                        <span style="font-size:18px; font-weight:700;">"${step.text || step.phrase}"</span>
                        <div style="margin-top:5px; font-size:12px; color:#64748b; cursor:pointer;" onclick="speak('${step.text || step.phrase}')">üîä Listen first</div>
                    </div>
                </div>
            `;
        }

        // D. GAME
        else if (step.type === 'game') {
            html += `
                <div style="padding:40px; background:#fff7ed; border-radius:20px; border:2px dashed #fed7aa;">
                    <div style="font-size:50px; margin-bottom:10px;">üé≤</div>
                    <h3 style="color:#9a3412; margin-bottom:10px;">${step.text}</h3>
                    <p style="color:#64748b;">${step.sub}</p>
                </div>
            `;
        }

        // E. MISSION
        else if (step.type === 'offscreen') {
            html += `
                <div class="mission-box" style="text-align:center;">
                    <div style="font-size:60px; margin-bottom:10px;">${step.icon}</div>
                    <h3 style="color:#334155; margin-bottom:10px;">Off-Screen Mission</h3>
                    <p style="font-size:18px; font-weight:600; color:var(--navy);">${step.text}</p>
                    <p style="color:#64748b; font-size:13px; margin-top:10px;">Put the phone down and go!</p>
                </div>
            `;
        }

        card.innerHTML = html;
        
        // Re-apply parent mode visibility
        toggleParentMode();
        toggleParentMode(); // toggle twice to refresh state
    }

    function nextStep() {
        if (stepIndex < currentData.steps.length - 1) {
            renderStep(stepIndex + 1);
        }
    }

    function prevStep() {
        if (stepIndex > 0) {
            renderStep(stepIndex - 1);
        } else {
            document.getElementById('screen-lesson').classList.remove('active');
            document.getElementById('screen-start').classList.add('active');
        }
    }

    function toggleMic(btn) {
        if (!isRecording) {
            btn.classList.add('recording');
            isRecording = true;
        } else {
            btn.classList.remove('recording');
            isRecording = false;
            // Success sound
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.setValueAtTime(600, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
            osc.start();
            osc.stop(ctx.currentTime + 0.5);
        }
    }

    function speak(text) {
        if ('speechSynthesis' in window) {
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'en-US';
            msg.rate = 0.9;
            window.speechSynthesis.speak(msg);
        }
    }

    function finishLesson() {
        document.getElementById('screen-lesson').classList.remove('active');
        document.getElementById('screen-report').classList.add('active');
        
        // Populate Report
       const vocab = currentData.vocab || currentData.meta?.vocab || "";
       const phrase = currentData.phrase || currentData.meta?.phrase || ""; 
       document.getElementById('report-vocab').innerText = vocab;
       document.getElementById('report-phrase').innerText = phrase ? `"${phrase}"` : "";

        if (typeof confetti === 'function') {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#22d3ee', '#f97316', '#a78bfa'] });
        }
    }

    init();
</script>

</body>
</html>
