<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson â€” LinguaLab</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #22d3ee; 
            --navy: #1f4e79; 
            --bg: #f8fafc; 
            --white: #ffffff; 
            --orange: #f97316; 
            --radius: 24px;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #334155; padding-top: 80px; }
        
        /* NAVBAR */
        .navbar { 
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            display: flex; align-items: center; justify-content: space-between; 
            padding: 12px 40px; background: #fff; box-shadow: 0 4px 20px rgba(0,0,0,.05);
        }
        .navbar-left { display: flex; align-items: center; gap: 10px; }
        .nav-logo { height: 50px; width: auto; display: block; }
        .nav-title { font-size: 22px; font-weight: 800; color: var(--navy); }
        .navbar-right { display: flex; gap: 15px; }
        .navbar-right a { 
            text-decoration: none; color: var(--navy); font-weight: 600; font-size: 14px; transition: 0.2s; 
            padding: 8px 12px; border-radius: 8px;
        }
        .navbar-right a:hover { background: #f1f5f9; color: var(--primary); }

        /* HERO COMPACT */
        .hero-compact {
            padding: 40px 8% 100px;
            text-align: center;
            background: linear-gradient(135deg, #22d3ee, #a78bfa);
            color: #fff;
        }
        .hero-compact h1 { font-size: 36px; font-weight: 800; margin-bottom: 5px; }
        
        /* CONTAINER */
        .container { 
            max-width: 800px; margin: -60px auto 40px; 
            padding: 0 20px; position: relative; z-index: 10;
        }

        /* BACK BUTTON */
        .back-btn { 
            display: inline-flex; align-items: center; text-decoration: none; 
            color: var(--navy); font-weight: 700; margin-bottom: 20px; 
            background: white; padding: 12px 25px; border-radius: 99px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: 0.3s;
        }
        .back-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
        .back-btn span { margin-right: 8px; font-size: 18px; }

        /* LESSON HEADER CARD */
        .lesson-header-card { 
            background: white; border-radius: var(--radius); padding: 30px; 
            margin-bottom: 30px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); border-top: 6px solid var(--primary);
        }
        .lesson-tag { 
            background: #e0f2fe; color: var(--navy); padding: 6px 14px; 
            border-radius: 20px; font-size: 12px; text-transform: uppercase; 
            letter-spacing: 1px; font-weight: 700;
        }
        .lesson-title { font-size: 28px; font-weight: 800; color: var(--navy); margin: 15px 0 5px; }
        .lesson-subtitle { color: #64748b; font-size: 16px; }

        /* STEPS */
        .step-card { 
            background: white; border-radius: 20px; padding: 25px; margin-bottom: 25px; 
            border: 1px solid #e2e8f0; position: relative; overflow: hidden;
        }
        .step-number { 
            background: var(--primary); color: white; width: 32px; height: 32px; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-weight: 800; margin-bottom: 15px; font-size: 14px;
        }
        .step-title { font-weight: 800; color: var(--navy); font-size: 18px; margin-bottom: 5px; }
        .step-desc-en { font-size: 18px; color: #0f172a; margin-bottom: 8px; font-weight: 600; }
        .step-desc-zh { font-size: 15px; color: #64748b; line-height: 1.6; border-left: 3px solid #cbd5e1; padding-left: 10px; margin-bottom: 15px; }

        /* INTERACTIVE */
        .flashcard-box { 
            background: #f0f9ff; border: 2px dashed #bae6fd; border-radius: 12px; 
            padding: 15px; text-align: center; margin: 15px 0; 
        }
        .vocab-word { font-size: 20px; font-weight: 700; color: #0284c7; margin: 0 10px; }

        .audio-box { 
            background: #f8fafc; padding: 15px; border-radius: 16px; 
            display: flex; align-items: center; gap: 15px; border: 1px solid #e2e8f0; 
        }
        .rec-btn { 
            width: 45px; height: 45px; border-radius: 50%; border: none; 
            background: #ef4444; color: white; cursor: pointer; 
            display: flex; justify-content: center; align-items: center; 
            transition: 0.2s; font-size: 20px;
        }
        .rec-btn.recording { animation: pulse 1.5s infinite; background: #991b1b; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.6); } 70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); } }

        /* FOOTER BUTTON */
        .complete-btn { 
            background: var(--navy); color: white; border: none; padding: 18px; 
            border-radius: 16px; font-size: 18px; font-weight: 800; cursor: pointer; 
            transition: 0.3s; width: 100%; margin-top: 20px; display: block;
        }
        .complete-btn:hover { background: #334155; transform: translateY(-2px); }

        /* MODAL */
        .sticker-modal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); 
            display: none; justify-content: center; align-items: center; z-index: 2000; backdrop-filter: blur(5px);
        }
        .sticker-content { 
            background: white; padding: 40px; border-radius: 30px; text-align: center; 
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="navbar-left">
        <img src="assets/img/logo.png" alt="LL" class="nav-logo" onerror="this.style.display='none'">
        <span class="nav-title">LinguaLab</span>
    </div>
    <div class="navbar-right">
        <a href="index.html">Main Page</a>
        <a href="grammar.html">Grammar Magic</a>
        <a href="vocabulary.html">Word Bank</a>
        <a href="parents.html">Parents Wiki</a>
    </div>
</nav>

<section class="hero-compact">
    <h1>Lesson Time âš¡</h1>
</section>

<div class="container">
    <a href="exercises.html" class="back-btn"><span>â†</span> Back to Dashboard</a>

    <div id="lesson-container">
        </div>
</div>

<div class="sticker-modal" id="modal" onclick="this.style.display='none'">
    <div class="sticker-content">
        <div style="font-size: 60px;">ğŸŒŸ</div>
        <h2 style="color: var(--navy); margin: 10px 0;">Super Star!</h2>
        <p>Mission Completed!</p>
    </div>
</div>

<script>
    // DATABASE (Sep - Feb)
    const db = {
        "Sep": [
            {
                title: "Greetings & Song", tag: "Unit 2: My School",
                steps: [
                    { title: "Sing Along", en: "Play the 'Hello' song. Wave your hand!", zh: "æ’­æ”¾ 'Hello' æ­Œ (èª²æœ¬ç¬¬10é )ã€‚ä¸€é‚Šå”±ä¸€é‚Šæ®æ‰‹æ‰“æ‹›å‘¼ï¼" },
                    { title: "Practice Speaking", en: "Say: 'Hello, I'm (Name).'", zh: "ç·´ç¿’è‡ªæˆ‘ä»‹ç´¹ï¼š'Hello, I'm... (åŠ ä¸Šå­©å­çš„åå­—)'ã€‚", vocab: ["Hello", "I'm..."] },
                    { title: "Record Voice", en: "Record: 'Good morning, teacher.'", zh: "éŒ„éŸ³æŒ‘æˆ°ï¼š'Good morning, teacher.'", phrase: "Good morning, teacher.", type: "speak" }
                ]
            },
            {
                title: "School Objects Hunt", tag: "Unit 2: My School",
                steps: [
                    { title: "New Words", en: "Learn: Bag, Book, Teacher.", zh: "å­¸ç¿’å–®è©ï¼šBag (æ›¸åŒ…), Book (æ›¸), Teacher (è€å¸«)ã€‚", vocab: ["Bag", "Book"] },
                    { title: "Hide & Seek", en: "Hide a book. Ask: 'Where is the book?'", zh: "å°‹å¯¶éŠæˆ²ï¼šæŠŠæ›¸è—èµ·ä¾†ã€‚å• 'Where is the book?' è®“å­©å­æ‰¾å‡ºä¾†ã€‚" },
                    { title: "Record Voice", en: "Record: 'It is a book.'", zh: "éŒ„éŸ³æŒ‘æˆ°ï¼š'It is a book.'", phrase: "It is a book.", type: "speak" }
                ]
            },
            {
                title: "The Magic 'B' & TPR", tag: "Unit 2: Phonics",
                steps: [
                    { title: "Phonics Sound", en: "The letter B makes the /b/ sound.", zh: "å­—æ¯ B ç™¼å‡º /b/ çš„è²éŸ³ã€‚", vocab: ["Bb", "/b/"] },
                    { title: "Commands", en: "Action: 'Open your book'. 'Show me your book'.", zh: "è½æŒ‡ä»¤åšå‹•ä½œï¼šOpen your book (æ‰“é–‹æ›¸)ï¼ŒShow me your book (çµ¦æˆ‘çœ‹æ›¸)ã€‚" },
                    { title: "Record Voice", en: "Record: 'Open your book.'", zh: "éŒ„éŸ³æŒ‘æˆ°ï¼š'Open your book.'", phrase: "Open your book.", type: "speak" }
                ]
            },
            {
                title: "Review: First Day", tag: "Unit 2: Revision",
                steps: [
                    { title: "Who is this?", en: "Point to Mike and Kelly.", zh: "çœ‹åœ–ç‰‡ã€‚æŒ‡å‡ºèª°æ˜¯ Mikeï¼Œèª°æ˜¯ Kellyã€‚" },
                    { title: "Record Voice", en: "Record: 'Hello, I'm Mike.'", zh: "éŒ„éŸ³æŒ‘æˆ°ï¼š'Hello, I'm Mike.'", phrase: "Hello, I'm Mike.", type: "speak" }
                ]
            }
        ],
        "Oct": [
            {
                title: "Boy or Girl?", tag: "Unit 3: My Friends",
                steps: [
                    { title: "Song Time", en: "Sing: 'You're a boy / You're a girl'.", zh: "å”±æ­Œï¼š'You're a boy' (ä½ æ˜¯ç”·å­©)ï¼Œ'You're a girl' (ä½ æ˜¯å¥³å­©)ã€‚", vocab: ["Boy", "Girl"] },
                    { title: "Record Voice", en: "Record: 'I am a girl.'", zh: "éŒ„éŸ³æŒ‘æˆ°ï¼š'I am a girl/boy.'", phrase: "I am a girl.", type: "speak" }
                ]
            },
            {
                title: "My Best Friend", tag: "Unit 3: My Friends",
                steps: [
                    { title: "Phrase", en: "Say: 'This is my friend'.", zh: "ç·´ç¿’èªªï¼š'This is my friend' (é€™æ˜¯æˆ‘çš„æœ‹å‹)ã€‚", vocab: ["My Friend"] },
                    { title: "Record Voice", en: "Record: 'This is my friend.'", zh: "éŒ„éŸ³æŒ‘æˆ°ï¼š'This is my friend.'", phrase: "This is my friend.", type: "speak" }
                ]
            },
            {
                title: "Phonics Gg", tag: "Unit 3: Phonics",
                steps: [
                    { title: "Listen", en: "Listen to /g/. 'Girls' and 'Game'.", zh: "è½ /g/ çš„ç™¼éŸ³ã€‚å–®è©ï¼šGirls (å¥³å­©å€‘), Game (éŠæˆ²)ã€‚", vocab: ["Gg", "/g/"] },
                    { title: "Record Voice", en: "Record: 'Stand up, please.'", zh: "éŒ„éŸ³æŒ‘æˆ°ï¼š'Stand up, please.'", phrase: "Stand up, please.", type: "speak" }
                ]
            },
            {
                title: "Messy Family", tag: "Reader 1",
                steps: [
                    { title: "Story Time", en: "Read 'A Messy Family'. Find Daddy.", zh: "é–±è®€æ•…äº‹ï¼š'A Messy Family'ã€‚æ‰¾å‡º Daddy (çˆ¸çˆ¸)ã€‚" },
                    { title: "Record Voice", en: "Record: 'This is my Daddy.'", zh: "éŒ„éŸ³æŒ‘æˆ°ï¼š'This is my Daddy.'", phrase: "This is my Daddy.", type: "speak" }
                ]
            }
        ],
        "Nov": [
            { title: "Face Song", tag: "Unit 4", steps: [{ title: "Touch", en: "Touch your nose!", zh: "æ‘¸é¼»å­ï¼", type: "speak", phrase: "My nose." }] },
            { title: "Funny Faces", tag: "Unit 4", steps: [{ title: "Make", en: "Make a fruit face.", zh: "åšæ°´æœè‡‰è­œã€‚", type: "speak", phrase: "My mouth." }] },
            { title: "Phonics Mm", tag: "Unit 4", steps: [{ title: "Sound", en: "M is for Monkey.", zh: "M æ˜¯ Monkeyã€‚", type: "speak", phrase: "Monkey." }] },
            { title: "Buzz! Buzz!", tag: "Reader 2", steps: [{ title: "Bee", en: "Oh, my hair!", zh: "å™¢ï¼Œæˆ‘çš„é ­é«®ï¼", type: "speak", phrase: "My hair." }] }
        ],
        "Dec": [
            { title: "Farm Animals", tag: "Unit 5", steps: [{ title: "Moo", en: "Cow says Moo.", zh: "ç‰›å« Mooã€‚", type: "speak", phrase: "Cow." }] },
            { title: "Counting 1-3", tag: "Unit 5", steps: [{ title: "Count", en: "One, Two, Three.", zh: "ä¸€ï¼ŒäºŒï¼Œä¸‰ã€‚", type: "speak", phrase: "One, Two." }] },
            { title: "Phonics Pp", tag: "Unit 5", steps: [{ title: "Color", en: "Pink Pig.", zh: "ç²‰ç´…è±¬ã€‚", type: "speak", phrase: "Pink pig." }] },
            { title: "Winter Review", tag: "Unit 5", steps: [{ title: "Review", en: "I like animals.", zh: "æˆ‘å–œæ­¡å‹•ç‰©ã€‚", type: "speak", phrase: "Animals." }] }
        ],
        "Jan": [
            { title: "Zoo Visit", tag: "Unit 6", steps: [{ title: "Look", en: "Look at the Panda.", zh: "çœ‹ç†Šè²“ã€‚", type: "speak", phrase: "Panda." }] },
            { title: "Photo Time", tag: "Unit 6", steps: [{ title: "Click", en: "Take a photo.", zh: "æ‹ç…§ã€‚", type: "speak", phrase: "Photo." }] },
            { title: "Phonics Tt", tag: "Unit 6", steps: [{ title: "Tea", en: "Tiger and Tea.", zh: "è€è™å’ŒèŒ¶ã€‚", type: "speak", phrase: "Tea please." }] },
            { title: "Zoo Rules", tag: "Unit 6", steps: [{ title: "Shh", en: "Be quiet.", zh: "å®‰éœã€‚", type: "speak", phrase: "Be quiet." }] }
        ],
        "Feb": [
            { title: "Transport", tag: "Unit 7", steps: [{ title: "Car", en: "Beep beep!", zh: "å¿…å¿…ï¼", type: "speak", phrase: "It is a car." }] },
            { title: "My Bike", tag: "Unit 7", steps: [{ title: "Oops", en: "Oh my bike.", zh: "å™¢æˆ‘çš„å–®è»Šã€‚", type: "speak", phrase: "My bike." }] },
            { title: "Phonics Cc", tag: "Unit 7", steps: [{ title: "Cat", en: "Cat and Car.", zh: "è²“å’Œè»Šã€‚", type: "speak", phrase: "Car." }] },
            { title: "Traffic Lights", tag: "Unit 7", steps: [{ title: "Stop", en: "Red light Stop.", zh: "ç´…ç‡ˆåœã€‚", type: "speak", phrase: "Stop." }] }
        ]
    };

    // ===========================================
    // LOGIC
    // ===========================================
    function loadLesson() {
        const params = new URLSearchParams(window.location.search);
        const month = params.get('m');
        const weekIndex = parseInt(params.get('w'));

        // Error Handling if data missing
        if (!month || !db[month] || !db[month][weekIndex]) {
            document.getElementById('lesson-container').innerHTML = `
                <div style="text-align:center; padding: 40px;">
                    <h2>Lesson Under Development</h2>
                    <p>Please check back later!</p>
                </div>
            `;
            return;
        }

        const lesson = db[month][weekIndex];

        // 1. Render Header
        let html = `
            <div class="lesson-header-card">
                <span class="lesson-tag">${lesson.tag}</span>
                <h1 class="lesson-title">${lesson.title}</h1>
                <div class="lesson-subtitle">${month} â€¢ Week ${weekIndex + 1}</div>
            </div>
        `;

        // 2. Render Steps
        lesson.steps.forEach((step, index) => {
            html += `
                <div class="step-card">
                    <div class="step-number">${index + 1}</div>
                    <div class="step-title">${step.title}</div>
                    <div class="step-desc-en">${step.en}</div>
                    <div class="step-desc-zh">${step.zh}</div>
            `;

            if (step.vocab) {
                html += `<div class="flashcard-box">`;
                step.vocab.forEach(w => html += `<span class="vocab-word">${w}</span>`);
                html += `</div>`;
            }

            if (step.type === 'speak') {
                html += `
                    <div class="audio-box">
                        <button class="rec-btn" onclick="toggleRecord(this)">ğŸ¤</button>
                        <div>
                            <strong>Tap mic & say:</strong><br>
                            <span style="color:#64748b">"${step.phrase}"</span>
                        </div>
                    </div>
                `;
            }

            html += `</div>`;
        });

        // 3. Footer Button
        html += `
            <button class="complete-btn" onclick="document.getElementById('modal').style.display='flex'">
                Complete Lesson
            </button>
        `;

        document.getElementById('lesson-container').innerHTML = html;
    }

    // Audio Simulation
    let isRecording = false;
    function toggleRecord(btn) {
        if (!isRecording) {
            btn.classList.add('recording');
            isRecording = true;
        } else {
            btn.classList.remove('recording');
            isRecording = false;
            // Play success sound
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.setValueAtTime(600, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
            osc.start();
            osc.stop(ctx.currentTime + 0.5);
        }
    }

    // Run
    loadLesson();
</script>

</body>
</html>
