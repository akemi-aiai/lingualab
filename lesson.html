<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson ‚Äî LinguaLab</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary: #22d3ee;
            --primary-dark: #0ea5e9;
            --navy: #1f4e79;
            --bg: #f8fafc;
            --white: #ffffff;
            --orange: #f97316;
            --green: #10b981;
            --radius: 24px;
            --shadow: 0 12px 30px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #334155; padding-top: 70px; padding-bottom: 100px; }

        /* --- UI COMPONENTS --- */
        .icon { width: 24px; height: 24px; fill: currentColor; vertical-align: middle; }
        
        /* NAVBAR */
        .navbar {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 20px; background: rgba(255,255,255,0.95); 
            backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,.05);
            height: 70px;
        }
        .nav-left { display: flex; align-items: center; gap: 10px; font-weight: 800; color: var(--navy); }
        .nav-logo { height: 36px; }
        
        /* PROGRESS BAR */
        .progress-track { position: fixed; top: 70px; left: 0; width: 100%; height: 6px; background: #e2e8f0; z-index: 999; }
        .progress-fill { height: 100%; background: var(--orange); width: 0%; transition: width 0.5s ease; }

        /* CONTAINER */
        .container { max-width: 600px; margin: 0 auto; padding: 20px; position: relative; }

        /* PARENT TOGGLE */
        .parent-toggle-wrapper {
            display: flex; justify-content: flex-end; margin-bottom: 10px;
        }
        .parent-toggle {
            background: #e2e8f0; color: #64748b; padding: 6px 12px; 
            border-radius: 20px; font-size: 12px; font-weight: 700; 
            cursor: pointer; border: none; display: flex; align-items: center; gap: 5px;
        }
        .parent-toggle.active { background: var(--navy); color: white; }

        /* PARENT TIPS BOX (Hidden by default) */
        .parent-tips-box {
            display: none; background: #fff7ed; border-left: 4px solid var(--orange);
            padding: 15px; border-radius: 12px; margin-bottom: 20px; font-size: 14px;
            color: #7c2d12; box-shadow: 0 4px 10px rgba(249, 115, 22, 0.1);
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- SCREENS --- */
        .screen { display: none; animation: fadeIn 0.4s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* 1. START SCREEN (Hook) */
        .start-card {
            background: white; border-radius: var(--radius); padding: 30px;
            text-align: center; box-shadow: var(--shadow);
        }
        .trust-badge { 
            display: inline-block; background: #ecfeff; color: var(--navy); 
            padding: 4px 10px; border-radius: 6px; font-size: 11px; 
            font-weight: 800; text-transform: uppercase; margin-bottom: 15px;
        }
        .hero-title { font-size: 28px; font-weight: 900; color: var(--navy); line-height: 1.2; margin-bottom: 10px; }
        .hero-promise { font-size: 16px; color: #475569; margin-bottom: 25px; }
        .pain-points { text-align: left; background: #f8fafc; padding: 15px; border-radius: 16px; margin-bottom: 25px; }
        .pain-item { display: flex; gap: 10px; margin-bottom: 10px; font-size: 13px; color: #64748b; align-items: center; }
        .check { color: var(--green); font-weight: bold; }

        /* 2. LESSON STEPS */
        .step-card {
            background: white; border-radius: var(--radius); padding: 30px 20px;
            text-align: center; box-shadow: var(--shadow); min-height: 400px;
            display: flex; flex-direction: column; justify-content: center;
        }
        .step-tag {
            color: var(--primary-dark); font-weight: 800; text-transform: uppercase; 
            font-size: 12px; letter-spacing: 1px; margin-bottom: 10px;
        }
        .step-main-text { font-size: 24px; font-weight: 800; color: var(--navy); margin-bottom: 20px; }
        
        /* Flashcards */
        .flashcard-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .flashcard {
            border: 2px solid #e2e8f0; border-radius: 16px; padding: 15px;
            cursor: pointer; transition: 0.2s;
        }
        .flashcard.playing { border-color: var(--primary); background: #ecfeff; transform: scale(1.05); }
        .fc-icon { font-size: 32px; display: block; margin-bottom: 5px; }
        .fc-word { font-weight: 700; font-size: 14px; }

        /* Interactive Buttons */
        .action-btn {
            background: var(--navy); color: white; border: none; 
            padding: 18px; width: 100%; border-radius: 16px; 
            font-size: 18px; font-weight: 700; cursor: pointer; 
            box-shadow: 0 4px 15px rgba(31, 78, 121, 0.2);
            display: flex; justify-content: center; align-items: center; gap: 10px;
            transition: 0.2s; margin-top: auto;
        }
        .action-btn:active { transform: scale(0.98); }
        .action-btn.secondary { background: white; color: var(--navy); border: 2px solid #e2e8f0; margin-top: 10px; }

        /* 3. REPORT CARD */
        .report-card {
            background: white; border-radius: var(--radius); padding: 30px;
            text-align: center; box-shadow: var(--shadow);
            border-top: 8px solid var(--green);
        }
        .report-title { font-size: 22px; font-weight: 800; color: var(--navy); margin-bottom: 5px; }
        .report-list { text-align: left; margin: 20px 0; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; }
        .report-item { margin-bottom: 8px; font-size: 14px; color: #334155; }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: white; padding: 15px 20px; 
            border-top: 1px solid #e2e8f0; display: flex; gap: 10px; z-index: 1000;
        }
        
    </style>
</head>
<body>

<div class="progress-track"><div class="progress-fill" id="progress-bar"></div></div>

<nav class="navbar">
    <div class="nav-left">
        <a href="exercises.html" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 8px;">
            <svg class="icon" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            <span id="nav-month">Back</span>
        </a>
    </div>
    <div class="parent-toggle-wrapper">
        <button class="parent-toggle" onclick="toggleParentMode()">
            <svg class="icon" style="width:16px;height:16px;" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>
            Parent Mode
        </button>
    </div>
</nav>

<div class="container">

    <div class="parent-tips-box" id="parent-box">
        <strong>üë®‚Äçüë©‚Äçüëß Parent Tip:</strong> <span id="parent-text">Relax. Don't correct mistakes today. Just have fun!</span>
    </div>

    <div id="screen-start" class="screen active">
        <div class="start-card">
            <span class="trust-badge">Ages 3‚Äì6 ‚Ä¢ 7 Minutes</span>
            <h1 class="hero-title">7 Minutes.<br>Zero Prep.<br>Just press Play.</h1>
            <p class="hero-promise">No teacher needed. We guide you step-by-step.</p>
            
            <div class="pain-points">
                <div class="pain-item"><span class="check">‚úì</span> <b>Today's Goal:</b> 6 words + 1 phrase</div>
                <div class="pain-item"><span class="check">‚úì</span> <b>Anxiety Relief:</b> Child tired? Use "2-min mode"</div>
                <div class="pain-item"><span class="check">‚úì</span> <b>Result:</b> Visible progress today</div>
            </div>

            <button class="action-btn" onclick="startLesson()">
                Start Lesson ‚ñ∂
            </button>
        </div>
    </div>

    <div id="screen-lesson" class="screen">
        <div class="step-card" id="step-card">
            </div>
        
        <div class="bottom-nav">
            <button class="action-btn secondary" style="width: 30%" onclick="prevStep()">‚Üê</button>
            <button class="action-btn" style="width: 70%" onclick="nextStep()" id="next-btn">Next Step ‚Üí</button>
        </div>
    </div>

    <div id="screen-report" class="screen">
        <div class="report-card">
            <div style="font-size: 60px; margin-bottom: 10px;">üèÜ</div>
            <h2 class="report-title">Lesson Complete!</h2>
            <p style="color: #64748b;">You are a Tiny Hero!</p>

            <div class="report-list">
                <div style="font-weight:700; margin-bottom:10px; color:var(--navy);">PARENT REPORT:</div>
                <div class="report-item">‚úÖ <b>Learned:</b> <span id="report-vocab"></span></div>
                <div class="report-item">‚úÖ <b>Spoke:</b> <span id="report-phrase"></span></div>
                <div class="report-item">‚úÖ <b>Next time:</b> Review & Play</div>
            </div>

            <button class="action-btn" onclick="window.location.href='exercises.html'">
                Back to Dashboard
            </button>
        </div>
    </div>

</div>

<script>
    // --- DATABASE (FULL CONTENT) ---
    const db = {
        "Sep": [
            {
                // Week 1
                meta: { unit: "Unit 2: Greetings", vocab: "Hello, Teacher", phrase: "Good morning" },
                tips: "Goal: Don't correct pronunciation yet. Just encourage them to open their mouth.",
                steps: [
                    { type: 'warmup', title: "Warm Up", text: "Listen and Wave! üëã", action: "Say: 'Hello!'", audio: "Hello!" },
                    { type: 'words', title: "3 Words", items: [{w:"Hello", i:"üëã"}, {w:"Teacher", i:"üë©‚Äçüè´"}, {w:"Morning", i:"‚òÄÔ∏è"}] },
                    { type: 'phrase', title: "Phrase of the Day", text: "Good morning, teacher.", script: "Ask child: Who do you see at school?" },
                    { type: 'game', title: "Quick Game", text: "Touch your nose if you hear 'Hello'!", sub: "Parent: Say 'Hello' randomly." },
                    { type: 'offscreen', title: "Mission üè†", text: "Find a toy and say 'Hello' to it!", icon: "üß∏" }
                ]
            },
            {
                // Week 2
                meta: { unit: "Unit 2: School", vocab: "Bag, Book, Pencil", phrase: "It is a book" },
                tips: "If they point instead of speaking, that's okay! Say the word for them.",
                steps: [
                    { type: 'warmup', title: "Warm Up", text: "Stand up & Sit down!", action: "Do it 3 times.", audio: "Stand up!" },
                    { type: 'words', title: "School Objects", items: [{w:"Bag", i:"üéí"}, {w:"Book", i:"üìñ"}, {w:"Pencil", i:"‚úèÔ∏è"}] },
                    { type: 'phrase', title: "Phrase of the Day", text: "It is a book.", script: "Point to a book and ask: What is this?" },
                    { type: 'game', title: "Hide & Seek", text: "Hide a book. Ask 'Where is the book?'", sub: "Child finds it." },
                    { type: 'offscreen', title: "Mission üè†", text: "Put a book in a bag.", icon: "üéí" }
                ]
            },
            {
                // Week 3
                meta: { unit: "Unit 2: Phonics", vocab: "Bb, Ball, Baby", phrase: "Open your book" },
                tips: "Focus on the 'b' sound. buh-buh-book.",
                steps: [
                    { type: 'warmup', title: "Warm Up", text: "Clap your hands!", action: "Clap 1, 2, 3.", audio: "Clap!" },
                    { type: 'words', title: "B Sound", items: [{w:"Bb", i:"üÖ±Ô∏è"}, {w:"Ball", i:"‚öΩ"}, {w:"Baby", i:"üë∂"}] },
                    { type: 'phrase', title: "Action Phrase", text: "Open your book.", script: "Command: Open! Close!" },
                    { type: 'game', title: "Blue Hunt", text: "Find something Blue (B is for Blue).", sub: "Go!" },
                    { type: 'offscreen', title: "Mission üè†", text: "Find a blue toy.", icon: "üîµ" }
                ]
            },
            {
                // Week 4
                meta: { unit: "Revision", vocab: "Mike, Kelly", phrase: "Hello I am..." },
                tips: "Roleplay time! Pretend to be different characters.",
                steps: [
                    { type: 'warmup', title: "Warm Up", text: "Shake your body!", action: "Shake shake shake.", audio: "Shake!" },
                    { type: 'words', title: "Characters", items: [{w:"Mike", i:"üë¶"}, {w:"Kelly", i:"üëß"}, {w:"Miss Wang", i:"üë©‚Äçüè´"}] },
                    { type: 'phrase', title: "Magic Phrase", text: "Hello, I am [Name].", script: "Practice with a puppet." },
                    { type: 'game', title: "Who is it?", text: "Cover the picture. Guess: Mike or Kelly?", sub: "Peek-a-boo!" },
                    { type: 'offscreen', title: "Mission üè†", text: "Introduce yourself to a pet/toy.", icon: "üê∂" }
                ]
            }
        ],
        "Oct": [
            {
                // Week 1
                meta: { unit: "Unit 3: Friends", vocab: "Boy, Girl", phrase: "I am a girl" },
                tips: "Gender can be tricky. Use family members as examples.",
                steps: [
                    { type: 'warmup', title: "Warm Up", text: "High Five!", action: "High five Mommy/Daddy.", audio: "High Five!" },
                    { type: 'words', title: "Words", items: [{w:"Boy", i:"üë¶"}, {w:"Girl", i:"üëß"}, {w:"Friend", i:"ü§ù"}] },
                    { type: 'phrase', title: "Phrase", text: "I am a girl / boy.", script: "Ask: Are you a boy?" },
                    { type: 'game', title: "Stand Up", text: "Boys stand up! Girls sit down!", sub: "Switch!" },
                    { type: 'offscreen', title: "Mission üè†", text: "Count boys/girls in the house.", icon: "üè†" }
                ]
            },
            {
                // Week 2
                meta: { unit: "Unit 3: Friendship", vocab: "My Friend", phrase: "This is my friend" },
                tips: "Encourage sharing.",
                steps: [
                    { type: 'warmup', title: "Warm Up", text: "Jump!", action: "Jump 3 times.", audio: "Jump!" },
                    { type: 'words', title: "Words", items: [{w:"Friend", i:"üë´"}, {w:"Play", i:"üéÆ"}, {w:"Nice", i:"üëç"}] },
                    { type: 'phrase', title: "Phrase", text: "This is my friend.", script: "Show a photo of a friend." },
                    { type: 'game', title: "Draw", text: "Draw your friend quickly!", sub: "1 minute." },
                    { type: 'offscreen', title: "Mission üè†", text: "Hug your friend (or toy).", icon: "üß∏" }
                ]
            },
            {
                // Week 3
                meta: { unit: "Unit 3: Phonics G", vocab: "Gg, Girl, Game", phrase: "Stand up please" },
                tips: "G sounds like 'guh'.",
                steps: [
                    { type: 'warmup', title: "Warm Up", text: "Wiggle your fingers.", action: "Wiggle wiggle.", audio: "Wiggle" },
                    { type: 'words', title: "G Sound", items: [{w:"Gg", i:"üî§"}, {w:"Girl", i:"üëß"}, {w:"Game", i:"üé≤"}] },
                    { type: 'phrase', title: "Command", text: "Stand up, please.", script: "Be polite!" },
                    { type: 'game', title: "Simon Says", text: "Simon says: Sit down.", sub: "Don't get tricked!" },
                    { type: 'offscreen', title: "Mission üè†", text: "Play a quick game.", icon: "üèÉ" }
                ]
            },
            {
                // Week 4
                meta: { unit: "Reader", vocab: "Family", phrase: "My Daddy" },
                tips: "Reading time. Point to the pictures.",
                steps: [
                    { type: 'warmup', title: "Story Time", text: "Look at the book cover.", action: "What do you see?", audio: "Look!" },
                    { type: 'words', title: "Family", items: [{w:"Daddy", i:"üë®"}, {w:"Mommy", i:"üë©"}, {w:"Messy", i:"üóëÔ∏è"}] },
                    { type: 'phrase', title: "Phrase", text: "This is my Daddy.", script: "Point to Daddy." },
                    { type: 'game', title: "Clean up", text: "Pretend to clean up the room.", sub: "Messy -> Clean." },
                    { type: 'offscreen', title: "Mission üè†", text: "Find Daddy's shoe.", icon: "üëû" }
                ]
            }
        ],
        "Nov": [
            { meta: { unit: "Unit 4: Face", vocab: "Eyes, Nose", phrase: "My nose" }, tips: "Touch your own face to demonstrate.", steps: [{type:'warmup', text:'Blink your eyes!'}, {type:'words', items:[{w:'Eye', i:'üëÅÔ∏è'},{w:'Nose', i:'üëÉ'},{w:'Mouth', i:'üëÑ'}]}, {type:'phrase', text:'This is my nose.'}, {type:'game', text:'Touch your... Nose!'}, {type:'offscreen', text:'Look in a mirror.'}] },
            { meta: { unit: "Unit 4: Fun", vocab: "Funny Face", phrase: "My mouth" }, tips: "Make funny faces!", steps: [{type:'warmup', text:'Smile!'}, {type:'words', items:[{w:'Ear', i:'üëÇ'},{w:'Face', i:'üòÄ'},{w:'Hair', i:'üíá'}]}, {type:'phrase', text:'My mouth is big.'}, {type:'game', text:'Make a fruit face (pretend).'}, {type:'offscreen', text:'Draw a face.'}] },
            { meta: { unit: "Unit 4: Phonics M", vocab: "Mm, Monkey", phrase: "Close eyes" }, tips: "Mmmmmm delicious.", steps: [{type:'warmup', text:'Rub your tummy.'}, {type:'words', items:[{w:'Mm', i:'‚ìÇÔ∏è'},{w:'Monkey', i:'üêí'},{w:'Milk', i:'ü•õ'}]}, {type:'phrase', text:'Close your eyes.'}, {type:'game', text:'Peek-a-boo!'}, {type:'offscreen', text:'Drink some milk/water.'}] },
            { meta: { unit: "Reader 2", vocab: "Bee", phrase: "Oh my hair" }, tips: "Buzz like a bee!", steps: [{type:'warmup', text:'Buzz....'}, {type:'words', items:[{w:'Bee', i:'üêù'},{w:'Hair', i:'üíá'},{w:'No', i:'üö´'}]}, {type:'phrase', text:'Oh, my hair!'}, {type:'game', text:'Bee is coming! Duck!'}, {type:'offscreen', text:'Touch your hair.'}] }
        ],
        "Dec": [
            { meta: { unit: "Unit 5: Farm", vocab: "Cow, Pig", phrase: "It is a cow" }, tips: "Animal sounds are great fun.", steps: [{type:'warmup', text:'Moo!'}, {type:'words', items:[{w:'Cow', i:'üêÆ'},{w:'Pig', i:'üê∑'},{w:'Duck', i:'ü¶Ü'}]}, {type:'phrase', text:'It is a cow.'}, {type:'game', text:'Guess the sound: Oink!'}, {type:'offscreen', text:'Walk like a duck.'}] },
            { meta: { unit: "Unit 5: Math", vocab: "1, 2, 3", phrase: "One pig" }, tips: "Count on fingers.", steps: [{type:'warmup', text:'Show 1 finger.'}, {type:'words', items:[{w:'One', i:'1Ô∏è‚É£'},{w:'Two', i:'2Ô∏è‚É£'},{w:'Three', i:'3Ô∏è‚É£'}]}, {type:'phrase', text:'I see two pigs.'}, {type:'game', text:'Count your fingers.'}, {type:'offscreen', text:'Count 3 toys.'}] },
            { meta: { unit: "Unit 5: Phonics P", vocab: "Pp, Pink", phrase: "Pink pig" }, tips: "P is a popping sound.", steps: [{type:'warmup', text:'Pop your cheeks.'}, {type:'words', items:[{w:'Pp', i:'üÖøÔ∏è'},{w:'Pink', i:'ü©∑'},{w:'Pen', i:'üñäÔ∏è'}]}, {type:'phrase', text:'A pink pig.'}, {type:'game', text:'Find Pink!'}, {type:'offscreen', text:'Touch something pink.'}] },
            { meta: { unit: "Review", vocab: "Animals", phrase: "I like animals" }, tips: "Review all animals.", steps: [{type:'warmup', text:'Clap 3 times.'}, {type:'words', items:[{w:'Hen', i:'üêî'},{w:'Pig', i:'üê∑'},{w:'Cow', i:'üêÆ'}]}, {type:'phrase', text:'I like animals.'}, {type:'game', text:'Act like a cow.'}, {type:'offscreen', text:'Sing Old McDonald.'}] }
        ],
        "Jan": [
            { meta: { unit: "Unit 6: Zoo", vocab: "Panda, Tiger", phrase: "Look at..." }, tips: "Wild animals!", steps: [{type:'warmup', text:'Roar!'}, {type:'words', items:[{w:'Panda', i:'üêº'},{w:'Tiger', i:'üêØ'},{w:'Bear', i:'üêª'}]}, {type:'phrase', text:'Look at the panda.'}, {type:'game', text:'Walk like a bear.'}, {type:'offscreen', text:'Find a teddy bear.'}] },
            { meta: { unit: "Unit 6: Photo", vocab: "Camera", phrase: "Take a photo" }, tips: "Pretend to use a camera.", steps: [{type:'warmup', text:'Smile!'}, {type:'words', items:[{w:'Monkey', i:'üêí'},{w:'Photo', i:'üì∑'},{w:'Zoo', i:'ü¶Å'}]}, {type:'phrase', text:'Take a photo.'}, {type:'game', text:'Freeze frame!'}, {type:'offscreen', text:'Take a pretend photo of Mom.'}] },
            { meta: { unit: "Unit 6: Phonics T", vocab: "Tt, Tiger", phrase: "Two tigers" }, tips: "T-t-t sound.", steps: [{type:'warmup', text:'Tap your toe.'}, {type:'words', items:[{w:'Tt', i:'‚úùÔ∏è'},{w:'Tea', i:'üçµ'},{w:'Table', i:'ü™ë'}]}, {type:'phrase', text:'Two tigers.'}, {type:'game', text:'Tap the table.'}, {type:'offscreen', text:'Touch a table.'}] },
            { meta: { unit: "Unit 6: Rules", vocab: "Quiet", phrase: "Be quiet" }, tips: "Shhh...", steps: [{type:'warmup', text:'Shhh...'}, {type:'words', items:[{w:'Quiet', i:'ü§´'},{w:'Sleep', i:'üò¥'},{w:'Loud', i:'üì¢'}]}, {type:'phrase', text:'Be quiet, please.'}, {type:'game', text:'Sleeping Lions (don\'t move).'}, {type:'offscreen', text:'Tip-toe walk.'}] }
        ],
        "Feb": [
            { meta: { unit: "Unit 7: Cars", vocab: "Car, Bus", phrase: "It is a bus" }, tips: "Vroom vroom!", steps: [{type:'warmup', text:'Beep beep!'}, {type:'words', items:[{w:'Car', i:'üöó'},{w:'Bus', i:'üöå'},{w:'Bike', i:'üö≤'}]}, {type:'phrase', text:'It is a bus.'}, {type:'game', text:'Drive the bus (steering wheel).'}, {type:'offscreen', text:'Find a wheel.'}] },
            { meta: { unit: "Unit 7: Oops", vocab: "Taxi", phrase: "Oh my bike" }, tips: "Emotions: Oh no!", steps: [{type:'warmup', text:'Oh no!'}, {type:'words', items:[{w:'Taxi', i:'üöï'},{w:'Wheel', i:'üõû'},{w:'Broken', i:'üíî'}]}, {type:'phrase', text:'Oh, my bike!'}, {type:'game', text:'Fall down gently.'}, {type:'offscreen', text:'Fix a toy.'}] },
            { meta: { unit: "Unit 7: Phonics C", vocab: "Cc, Cat", phrase: "Stop and Go" }, tips: "C is for Cat /k/.", steps: [{type:'warmup', text:'Meow.'}, {type:'words', items:[{w:'Cc', i:'¬©Ô∏è'},{w:'Cat', i:'üê±'},{w:'Cup', i:'‚òï'}]}, {type:'phrase', text:'Stop and Go.'}, {type:'game', text:'Red Light, Green Light.'}, {type:'offscreen', text:'Drink from a cup.'}] },
            { meta: { unit: "Review", vocab: "Colors", phrase: "Red light" }, tips: "Safety first.", steps: [{type:'warmup', text:'Stop!'}, {type:'words', items:[{w:'Red', i:'üî¥'},{w:'Green', i:'üü¢'},{w:'Yellow', i:'üü°'}]}, {type:'phrase', text:'Red light, Stop.'}, {type:'game', text:'Freeze dance.'}, {type:'offscreen', text:'Find something Red.'}] }
        ]
    };

    // --- LOGIC ---
    let currentData = null;
    let currentStepIndex = 0;

    function init() {
        // Parse URL params
        const params = new URLSearchParams(window.location.search);
        const m = params.get('m');
        const w = parseInt(params.get('w'));

        if (m && db[m] && db[m][w]) {
            currentData = db[m][w];
            // Populate Start Screen Text
            document.querySelector('.pain-points').innerHTML = `
                <div class="pain-item"><span class="check">‚úì</span> <b>Goal:</b> ${currentData.meta.unit}</div>
                <div class="pain-item"><span class="check">‚úì</span> <b>Vocab:</b> ${currentData.meta.vocab}</div>
                <div class="pain-item"><span class="check">‚úì</span> <b>Speak:</b> "${currentData.meta.phrase}"</div>
            `;
            // Populate Parent Tip
            document.getElementById('parent-text').innerText = currentData.tips;
            // Update Title
            document.getElementById('nav-month').innerText = "Back to " + m;
        } else {
            // Error state or default
            alert("Lesson not found. Redirecting...");
            window.location.href = 'exercises.html';
        }
    }

    function toggleParentMode() {
        const box = document.getElementById('parent-box');
        const btn = document.querySelector('.parent-toggle');
        if (box.style.display === 'block') {
            box.style.display = 'none';
            btn.classList.remove('active');
        } else {
            box.style.display = 'block';
            btn.classList.add('active');
        }
    }

    function startLesson() {
        document.getElementById('screen-start').classList.remove('active');
        document.getElementById('screen-lesson').classList.add('active');
        renderStep(0);
    }

    function renderStep(index) {
        currentStepIndex = index;
        const step = currentData.steps[index];
        const card = document.getElementById('step-card');
        const total = currentData.steps.length;
        
        // Update Progress Bar
        const pct = ((index + 1) / total) * 100;
        document.getElementById('progress-bar').style.width = pct + '%';

        // Update Next Button Text
        const nextBtn = document.getElementById('next-btn');
        if (index === total - 1) {
            nextBtn.innerText = "Finish Lesson üéâ";
            nextBtn.onclick = showReport;
        } else {
            nextBtn.innerText = "Next Step ‚Üí";
            nextBtn.onclick = nextStep;
        }

        // Render Content based on Type
        let html = `<div class="step-tag">Step ${index + 1}: ${step.title}</div>`;
        html += `<div class="step-main-text">${step.text}</div>`;

        // 1. WARMUP
        if (step.type === 'warmup') {
            html += `<button class="action-btn" onclick="speak('${step.text}'); this.style.background='#10b981'">‚ñ∂ Listen & Do</button>`;
        }

        // 2. WORDS
        else if (step.type === 'words') {
            html += `<div class="flashcard-container">`;
            step.items.forEach(item => {
                html += `
                    <div class="flashcard" onclick="speak('${item.w}'); this.classList.add('playing'); setTimeout(()=>this.classList.remove('playing'), 500)">
                        <span class="fc-icon">${item.i}</span>
                        <span class="fc-word">${item.w}</span>
                    </div>`;
            });
            html += `</div><div style="font-size:13px; color:#64748b">Tap cards to listen</div>`;
        }

        // 3. PHRASE
        else if (step.type === 'phrase') {
            html += `
                <div style="background:#ecfeff; padding:20px; border-radius:12px; margin-bottom:20px;">
                    üó£Ô∏è <b>Parent ask:</b><br>"${step.script}"
                </div>
                <button class="action-btn secondary" onclick="speak('${step.text}')">üîä Listen Answer</button>
            `;
        }

        // 4. GAME
        else if (step.type === 'game') {
            html += `<div style="font-size:50px; margin:20px;">üé≤</div>`;
            html += `<p style="color:#64748b; margin-bottom:20px;">${step.sub}</p>`;
        }

        // 5. OFFSCREEN
        else if (step.type === 'offscreen') {
            html += `<div style="font-size:60px; margin:20px;">${step.icon}</div>`;
            html += `<p style="color:#64748b">Put the phone down for 30 seconds!</p>`;
        }

        card.innerHTML = html;
    }

    function nextStep() {
        renderStep(currentStepIndex + 1);
    }

    function prevStep() {
        if (currentStepIndex > 0) renderStep(currentStepIndex - 1);
    }

    function showReport() {
        document.getElementById('screen-lesson').classList.remove('active');
        document.getElementById('screen-report').classList.add('active');
        
        // Fill Report
        document.getElementById('report-vocab').innerText = currentData.meta.vocab;
        document.getElementById('report-phrase').innerText = `"${currentData.meta.phrase}"`;
        
        // Confetti
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    }

    // TTS
    function speak(txt) {
        if ('speechSynthesis' in window) {
            const msg = new SpeechSynthesisUtterance(txt);
            msg.lang = 'en-US';
            window.speechSynthesis.speak(msg);
        }
    }

    // Start
    init();

</script>

</body>
</html>
